#textdomain wesnoth-Trinity

[scenario]
    id="F1c_h"
    name= _ "Out on Bond"
    map_data="{~add-ons/Trinity/maps/F1c_H.map}"
    next_scenario=F1c_k
    victory_when_enemies_defeated=no
    {TURNS 28 23 19}

    [music]
        name="the_king_is_dead.ogg"
    [/music]

    {BMR_STORE_SIDE 1}
    {BMR_RESTORE_SIDE 1}
    #    {BMR_STORE_SIDE 3}
    #    {BMR_RESTORE_SIDE 3}
    #    {DEFAULT_SCHEDULE}
    {UNDERGROUND}
    [story]
        [part]
            story= _ "Once Haldrad and Dardrus were out of the throneroom, Haldrad turned to face the Primeval spy.

	'I will not stand by while the prisoners - <i>my people</i> - are held in such danger!  And I will certainly not aid those who hold them!' the prince hissed.
	Dardrus replied in a low voice, 'If you could just play along-'
	'<i>No!</i>  I am going to go down to the gaol and free the prisoners,' the prince whispered.  'Then we shall fight our way out.  We'll get the Sceptre back on our own terms.'
	'Very well, do what you must.  But I continue to believe my subterfuge is our only chance to get the Sceptre and foil the plans of our enemies, so that is the course I must follow.'  Dardrus turned and began to walk away.  'I wish you luck, but if you are caught, I will not be able to help you - I may even be forced to kill you myself.'
"
            background="story/Trinity_throne.jpg"
        [/part]
        [part]
            story= _ "And with that, Haldrad and his followers made their way down to the prisons.  He had to act fast, before Bresda came to gather the prisoners for the forced march to wherever it was Nemesis wanted to go."
            background="story/Trinity_throne.jpg"
        [/part]
    [/story]

    [event]
        name=prestart
        [objectives]
            side=0
            [objective]
                condition=win
                description=_ "Free Prisoners and leave Elensefar Palace (reach signpost)."
            [/objective]
            [objective]
                condition=lose
                description=_ "Death of Haldrad"
            [/objective]
            #            [objective]
            #                condition=lose
            #                description=_ "Death of Dardrus"
            #            [/objective]
            #            [objective]
            #                condition=lose
            #                description=_ "Death of Bresda"
            #            [/objective]
            #            [objective]
            #                condition=lose
            #                description=_ "Prisoner Wagon gets attacked by Khthon"
            #            [/objective]
            #            [objective]
            #                condition=lose
            #                description=_ "Death of Prisoner Wagon"
            #            [/objective]
        [/objectives]
        # temporary
        [unit]
            id=Ponce
            side=3
            name="Ponce"
            type=SouthSeas Seadog
            x,y=1,1
        [/unit]
        [store_unit]
            [filter]
                id=Ponce
            [/filter]
            variable=ponce
            kill=yes
        [/store_unit]
        # /temporary
        #        [set_variable]
        #	    name=ponce.side
        #	    value=1
        #	[/set_variable]
        #	[unstore_unit]
        #	    variable=ponce
        #	    find_vacant=yes
        #	    x,y=16,33
        #	[/unstore_unit]
        [recall]
            id=Dardrus
            x,y=13,32
        [/recall]
        [store_unit]
            [filter]
                id=Dardrus
            [/filter]
            kill=yes
            variable=dardrus
        [/store_unit]
        [store_unit]
            [filter]
                id=Bresda_
            [/filter]
            kill=yes
            variable=bresda_
        [/store_unit]
        #        {TRANSFORM_UNIT (id=Bresda) "Primevalist Heroine"}
        #	{CAPTURE_VILLAGES SIDE X Y RADIUS}
        [unit]
            type=Primevalist Fanatic
            side=2
            id=Bailiff
            name="Bailiff"
            random_traits=yes
            x,y=18,28
            facing=sw
        [/unit]
        [unit]
            type=Primevalist Monk
            side=2
            random_traits=yes
            x,y=11,17
            facing=se
            ai_special=guardian
        [/unit]
        [unit]
            type=Primevalist Celebrant
            side=2
            random_traits=yes
            x,y=37,15
            facing=se
            ai_special=guardian
        [/unit]
        [unit]
            type=SouthSeas Wrecker
            side=2
            random_traits=yes
            x,y=35,5
            ai_special=guardian
            facing=sw
        [/unit]
        {ARCHAIC_KHTHONIZED (x,y=25,29)}
        [item]
            image="scenery/signpost.png"
            x,y=1,6
        [/item]
        [set_variable]
            name=f2c_key
            value=0
        [/set_variable]
        [set_variable]
            name=f2c_key2
            value=0
        [/set_variable]
        {OBJ_POTION_STRONG 22 28 Pot1}
        {OBJ_POTION_STRONG 30 28 Pot2}
        {OBJ_POTION_STRONG 7 17 Pot3}
        [time_area]
            x=20-22,20-22,21
            y=22,23,24
            {DUSK}
        [/time_area]
        [time_area]
            x=16-18,16-18,17
            y=4,5,6
            {DUSK}
        [/time_area]
    [/event]

    {ANIMATED_BRAZIER 15 26}
    {ANIMATED_BRAZIER 9 16}
    {ANIMATED_BRAZIER 36 13}
    {ANIMATED_BRAZIER 39 15}

    [side]
        type=Haldrad Fighter
        save_id=Royal
        id=Haldrad
        side=1
        canrecruit=yes
        controller=human
        fog=no
        shroud=yes
        recruit=Spearman, Bowman, Horseman
        {GOLD 150 130 110}
        {INCOME 6 4 2}
        team_name=Royal
    [/side]

    [side]
        type=Primevalist Leader
        id=Theodywen
        name= _ "Theodywen"
        facing=nw
        ellipse="misc/ellipse"
        [modifications]
            {TRAIT_STRONG}
            {TRAIT_QUICK}
        [/modifications]
        unrenamable=yes
        side=2
        canrecruit=yes
        controller=ai
        fog=no
#ifdef EASY
        recruit=Primevalist Fighter, Primevalist Follower
#endif
#ifdef NORMAL
        recruit=Primevalist Fighter, Primevalist Follower, Primevalist Fanatic
#endif
#ifdef HARD
        recruit=Primevalist Fighter, Primevalist Follower, Primevalist Fanatic, Primevalist Shield
#endif
        {GOLD 120 180 250}
        {INCOME 10 16 24}
        team_name=Primeval
        #        {ai/aliases/stable_singleplayer.cfg}
        #	[ai]
        #	{HIGH_PRIORITY_TARGETS}
        #	[/ai]
    [/side]

    [side]
        type=Primevalist Heroine
        id=Bresda_
        name= _ "Bresda"
        side=3
        canrecruit=yes
        controller=ai
        fog=no
        shroud=no
        recruit="SouthSeas Seaman, SouthSeas Caster, SouthSeas Swimmer, SouthSeas Arsonist, Primevalist Fighter, Primevalist Follower"
        {GOLD 200 250 300}
        {INCOME 4 6 8}
        team_name=Primeval
    [/side]

    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Primevalist Fanatic" 3}

    [event]
        name=start
        [music]
            name="loyalists.ogg"
            immediate=yes
            append=no
        [/music]
        [message]
            speaker=Haldrad
            message= _ "(I have not spent much time in this palace, so it will take a little exploring.  But I'm pretty sure the prisoners can be found down here.)"
        [/message]
        [message]
            speaker=Bailiff
            message= _ "What are you doing down here?"
        [/message]
        [message]
            speaker=Haldrad
            message= _ "I've come to round up the prisoners.  Nemesis wants us to get moving, we are leaving this city."
        [/message]
        [message]
            speaker=Bailiff
            message= _ "Hrmm...  Why isn't Bresda here with you?  No, I cannot unlock the prison doors until I get orders from her.  I think you should leave."
        [/message]
        [message]
            speaker=Haldrad
            message= _ "Well then...  I'll just have to take your keys from you.  To arms, brigand!"
        [/message]
        [message]
            speaker=Bailiff
            message= _ "Heh, princeling..."
        [/message]
    [/event]

#define TRI_PRISON_DOOR_OPEN X Y X2 Y2
    [event]
        name=moveto
        first_time_only=no
        id=prison_door_{X}
        [filter]
            side=1
            [filter_location]
                radius=1
                x,y={X},{Y}
            [/filter_location]
        [/filter]
        [if]
            [variable]
                name=f2c_key
                equals=1
            [/variable]
            [then]
                [set_variable]
                    name=tri_prison_type
                    rand=Woodsman,Spearman,Spearman,Bowman,Fencer,Mage,Spearman,Bowman,Cavalryman,Spearman,Royal Guard,Spearman,Bowman,Spearman,Thug,Thief
                [/set_variable]
                [message]
                    speaker=unit
                    message=_"Yes, the bailiff's keyring can open this door..."
                [/message]
                [terrain]
                    x,y={X},{Y}
                    terrain=Rrc
                [/terrain]
                [unit]
                    side=1
                    x,y={X2},{Y2}
                    type=$tri_prison_type
                [/unit]
                [redraw]
                    side=1
                [/redraw]
                [message]
                    x,y={X2},{Y2}
                    message=_"Thank you, let's leave this place."
                [/message]
                [event]
                    id=prison_door_{X}
                    remove=yes
                [/event]
            [/then]
            [else]
                [message]
                    speaker=unit
                    message=_"This door is locked..."
                [/message]
            [/else]
        [/if]
    [/event]
#enddef
    {TRI_PRISON_DOOR_OPEN 13 27 10 25}
    {TRI_PRISON_DOOR_OPEN 11 20 10 21}
    {TRI_PRISON_DOOR_OPEN 7 16 5 15}
    {TRI_PRISON_DOOR_OPEN 17 19 18 17}
    {TRI_PRISON_DOOR_OPEN 32 28 34 29}
    {TRI_PRISON_DOOR_OPEN 27 18 26 16}
    {TRI_PRISON_DOOR_OPEN 30 20 33 21}
    {TRI_PRISON_DOOR_OPEN 37 22 38 24}

    [event]
        name=moveto
        first_time_only=no
        id=prison_door_queen
        [filter]
            side=1
            [filter_location]
                radius=1
                x,y=11,16
            [/filter_location]
        [/filter]
        [if]
            [variable]
                name=f2c_key2
                equals=1
            [/variable]
            [then]
                [message]
                    speaker=unit
                    message=_"Yes, the watch-captain's key can open this door."
                [/message]
                [terrain]
                    x,y=11,16
                    terrain=Rrc
                [/terrain]
                [unit]
                    side=1
                    x,y=13,14
                    type=Battle Queen_
                    id=Caldera
                    name="Queen Caldera"
                    [modifications]
                        {TRAIT_LOYAL}
                    [/modifications]
                [/unit]
                [redraw]
                    side=1
                [/redraw]
                [message]
                    speaker=Caldera
                    message=_"Thank you...  Haldrad?  Is that you?"
                [/message]
                [message]
                    speaker=Haldrad
                    message=_"Mother, how glad I am to find you alive and well.  Let's get out of here!"
                [/message]
                [event]
                    id=prison_door_queen
                    remove=yes
                [/event]
            [/then]
            [else]
                [message]
                    speaker=unit
                    message=_"This door is locked.  The lock looks a little sturdier than the others..."
                [/message]
            [/else]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no
        id=prison_door_final
        [filter]
            side=1
            [filter_location]
                radius=1
                x,y=21,7
            [/filter_location]
        [/filter]
        [if]
            [variable]
                name=f2c_key2
                equals=1
            [/variable]
            [and]
                [have_unit]
                    id=Caldera
                [/have_unit]
            [/and]
            [then]
                [message]
                    speaker=unit
                    message=_"Yes, the watch-captain's key can open this door."
                [/message]
                [terrain]
                    x,y=21,7
                    terrain=Rrc
                [/terrain]
                [redraw]
                    side=1
                [/redraw]
                [message]
                    speaker=Caldera
                    message=_"That passage should let us out the palace near some woods.  It's a weak-point in the city defenses, but it is one the guard of Elensefar knows of and often uses as a lure for those who would attack."
                [/message]
                [message]
                    speaker=Haldrad
                    message=_"Hopefully the current hosts are unaware of it.  It's our only chance, so let's move!"
                [/message]
                [event]
                    id=prison_door_final
                    remove=yes
                [/event]
            [/then]
            [else]
                [message]
                    speaker=unit
                    message=_"This door is locked.  The lock looks a little sturdier than the others..."
                [/message]
            [/else]
        [/if]
    [/event]

    [event]
        name=moveto
        [filter]
            id=Haldrad
            x,y=1,6
        [/filter]
        [message]
            speaker=unit
            message=_"This path leads away from the city, come this way!"
        [/message]
        [message]
            speaker=Caldera
            message=_"As glad as I am to be free, this is a terrible defeat.  Where do we go from here?"
        [/message]
        [message]
            speaker=unit
            message=_"We'll discuss this in more detail in safer circumstances, but I think we should head east.  There is something there that the enemy wishes to find, and though I know not what nor where, we should have time to figure it out."
        [/message]
        [message]
            speaker=Bresda_
            message=_"After them!"
        [/message]
        [endlevel]
            result=victory
        [/endlevel]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            x=32-40
            y=12-18
        [/filter]
        [event]
            #	name=turn 2 # for testing
            name=new turn
            [unstore_unit]
                variable=ponce
                find_vacant=yes
                x,y=16,33
            [/unstore_unit]
            [message]
                speaker=Ponce
                message=_"Hail!  The commanding officer is coming this way!"
            [/message]
            [message]
                side=1
                message=_"Who are you?"
            [/message]
            [message]
                speaker=Ponce
                message=_"A friend.  I was rescued from the sea and brought to this city just before the assault."
            [/message]
            [message]
                side=1
                message=_"You don't exactly look like a local fisherman..."
            [/message]
            [message]
                speaker=Ponce
                message=_"I'm not, I came here with those who defeated this city, but I had a difference of opinion with the current leadership, so I was flushed out like so much bildge-water.  The enemy forces are good men under the hand of evil."
            [/message]
            [message]
                speaker=Haldrad
                message=_"Surely you can see how we cannot trust you?  But if you prove yourself true, you have a place with us, Outlander."
            [/message]
            [message]
                speaker=Ponce
                message=_"Please call me 'Ponce', for that is my name.  Now, shall we get away from here before Bresda arrives?"
            [/message]
            {MODIFY_UNIT id=Ponce side 1}
            [message]
                speaker=Haldrad
                message=_"(He knows who Bresda is and he seems genuinely alarmed about her approach...  Maybe what he says is true.)"
            [/message]
        [/event]
    [/event]

    [event]
        #	name=turn 3 # for testing
        name=turn 8
        first_time_only=no
        [event]
            name=new turn
            first_time_only=no
            [if]
                [have_unit]
                    id=Bresda_
                [/have_unit]
                [or]
                    [have_unit]
                        id=Theodywen
                    [/have_unit]
                [/or]
                [else]
                    [unstore_unit]
                        variable=bresda_
                        find_vacant=yes
                    [/unstore_unit]
                    [music]
                        name="legends_of_the_north.ogg"
                        immediate=yes
                        append=no
                    [/music]
                    [message]
                        speaker=Bresda_
                        message=_"What is going on here?!"
                    [/message]
                    [message]
                        speaker=Ponce
                        message=_"Bresda, you serve dark powers, and have brought yourself quite low to do so.  I thought more highly of you..."
                    [/message]
                    [message]
                        speaker=Bresda_
                        message=_"Well, Ponce.  Your presence means you are strong and tenacious, which I never doubted.  But wise?  No, you are not wise."
                    [/message]
                    [message]
                        speaker=Bresda_
                        message=_"Prince Haldrad!  I knew you did not really serve Dardrus!  Run, like the dogs that you are, we shall cut you down!"
                    [/message]
                [/else]
            [/if]
        [/event]
    [/event]

    # We'll just have to use this old chestnut for now.
    {FORCE_CHANCE_TO_HIT (side=1) id=Bresda_ 10 ()}

    [event]
        name=die
        [filter]
            id=Bailiff
        [/filter]
        [message]
            speaker=Haldrad
            message= _ "He has a heavy key-ring, we should be able to open the prison doors now."
        [/message]
        [set_variable]
            name=f2c_key
            value=1
        [/set_variable]
    [/event]

    [event]
        name=last_breath
        [filter]
            id=Theodywen
        [/filter]
        [message]
            speaker=Haldrad
            message= _ "Where is the Queen of Weldyn?"
        [/message]
        [message]
            speaker=unit
            message= _ "We killed her, this land has no more need for the old rulers.  She was soft and weak and without worth, like all of you royal inbreds..."
        [/message]
        [message]
            speaker=Haldrad
            message= _ "You would say that, wouldn't you?  I will not give you the dying satisfaction of seeing me angry."
        [/message]
        [kill]
            id=Theodywen
            animate=yes
        [/kill]
        [message]
            speaker=Haldrad
            message= _ "I see he has a large key chained to his belt.  I think we shall find that useful..."
        [/message]
        [set_variable]
            name=f2c_key2
            value=1
        [/set_variable]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Haldrad
        [/filter]
        [message]
            speaker=Haldrad
            message= _ "Oh, what a world..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=die
        [filter]
            id=Ponce
        [/filter]
        [message]
            speaker=Haldrad
            message= _ "We just lost a potential ally, and I really don't have the forces necessary to fight the monsters that wreck our Kingdom..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=time over
        [music]
            name=the_deep_path.ogg
            immediate=yes
        [/music]
        [message]
            speaker=narrator
            message= _ "There were sounds of footsteps and shouting from all directions.  Word of Haldrad's plot had spread, and now all the enemy forces were in place.  There was no escape..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
[/scenario]
