#textdomain wesnoth-Trinity

# Dark Planet is set ablaze by sending the ruined Mech Dragon down into the mechanical section chasm, and that becomes the new sun.

[scenario]
    id="Dark_Planet"
    name= _ "Dark Planet"
    map_data="{~add-ons/Trinity/maps/Dark_Planet.map}"
    next_scenario=Epilogue
    victory_when_enemies_defeated=no
    turns=-1
    #	{TURNS 8 10 12}

    [music]
        name="New_Wesnoth_Battle_Music.ogg"
    [/music]

    #    {BMR_STORE_SIDE 1}
    {BMR_RESTORE_SIDE 1}
    #    {BMR_RESTORE_SIDE 2}
    {BMR_RESTORE_SIDE 3}
    {BMR_RESTORE_SIDE 5}
    {TRINITY_DP_SCHEDULE}
    [story]
        [part]
            story= _ "Queen Caldera directed the party through the icy caverns, and into a hall made of metal and marble.  As the queen drew their attention to a complicated-looking metal and glass altar, Ponce noticed some damage to the structures, as well as some splashes of blood.  Blood that was still wet...

He followed a trail of this blood to an alcove full of metal contraptions.  They reminded him of something he once saw in a sawmill.  Then he spied something that was a dead-ringer for the crest Haldrad wore on his chest - the others would want to know about this!"
            [background_layer]
                image="story/Trinity_altar.jpg"
            [/background_layer]
        [/part]
        [part]
            story= _ "Ponce barely had time to rejoin the party at the altar before a minor quake shook the mountain.  Queen Caldera explained that she was lifting the Sky Mountain up into the night sky, beyond the night sky, to the home of the enemy."
            [background_layer]
                image="story/Trinity_space.jpg"
            [/background_layer]
        [/part]
        [part]
            story= _ "'The enemy is from a land so distant, it is amongst the stars,' explained Caldera.  'It moved from star to star, conquering and devouring all who it encountered.  But then it came to our lands, and our ancestors were able to repulse its attack.'

Haldrad knew that it was not his mother speaking, but rather the thing possessing her, be it daemon or angel.  As he and his officers stared slack-jawed at the strange, stary visions revealed on the glass wall, Queen Caldera continued her story."
            [background_layer]
                image="story/Trinity_space2.jpg"
            [/background_layer]
        [/part]
        [part]
            story= _ "'Though the enemy was unsuccessful, it was not really defeated, and it has been lurking in our shadow, biding its time.'  Caldera motioned toward the image of the dark moon that was gradually engulfing the entire panel of glass.  'Now it tries to devour us once more, and it is up to us to finish the work that our ancestors were forced to start so many years ago.'

The image of the dark moon filled the entire glass panel, and details of the surface were becoming evident.  It was mostly a dark and grey desert-scape, barren of anything resembling life.  But then Haldrad saw there was a small collection of structures, in various states of ruin, and it was towards these that the Sky Mountain was headed.  Queen Caldera made some quick movements over the altar, then stepped away and crouched against the wall.  'You will want to brace yourself against a stable surface, we are about to land.'"
            [background_layer]
                image="story/Trinity_space3.jpg"
            [/background_layer]
        [/part]
        [part]
            story= _ "This last scenario is under construction and is unfinished.  It should be possible to win it though."
            [background_layer]
                image="story/Trinity_warning.jpg"
            [/background_layer]
        [/part]
    [/story]

#define SETH_MESSAGE MESSAGE
    [message]
        speaker=narrator
        image=portraits/seth.png~O(0.5)
        caption=Seth
        message= _ {MESSAGE}
    [/message]
#enddef

#define TRI_SAVE_SHROUD SIDE POS
    [store_locations]
	[filter_vision]
	visible=no
	side={SIDE}
	[/filter_vision]
	variable=shroud_locs_{POS}
    [/store_locations]
#enddef

#define TRI_RESTORE_SHROUD SIDE POS

    [remove_shroud]
	side={SIDE}
	x,y=1-68,1-68
    [/remove_shroud]
    {FOREACH shroud_locs_{POS} index}
	[place_shroud]
	    side={SIDE}
	    x,y=$shroud_locs_{POS}[$index].x|,$shroud_locs_{POS}[$index].y|
	[/place_shroud]
    {NEXT index}
    {CLEAR_VARIABLE shroud_locs_{POS}}
#enddef


    # these macros should be probably be turned into an event
#define TRI_DARK_PLANET_UPPER FILTER SIDE
# problem is that AI side is sometimes SIDE, which screws things up
#    {TRI_SAVE_SHROUD {SIDE} lower}
    {TRI_SAVE_SHROUD ($player_side) lower}
    [set_variable]
        name=tri_on_surface
        value=yes
    [/set_variable]
    [store_unit]
        [filter]
            [not]
                {FILTER}
            [/not]
            [not]
                x,y=recall,recall
            [/not]
        [/filter]
        variable=units_down_below
        kill=yes
    [/store_unit]
# should I get rid of this?
#     [modify_side]
#        side={SIDE}
#        shroud=yes
#    [/modify_side]
#    {TRI_RESTORE_SHROUD {SIDE} upper}
    {TRI_RESTORE_SHROUD ($player_side) upper}
    [replace_map]
        map="{~add-ons/Trinity/maps/Dark_Planet.map}"
    [/replace_map]
    [redraw]
        side={SIDE}
    [/redraw]
    [replace_schedule]
        {TRINITY_DP_SCHEDULE}
    [/replace_schedule]
    [if]
        [variable]
            name=gate1_open
            equals=yes
        [/variable]
        [then]
            [terrain]
                terrain=Urb
                x=13,14
                y=67,66
            [/terrain]
            [redraw]
                side=1,3,5
            [/redraw]
        [/then]
    [/if]
    [if]
        [variable]
            name=gate2_open
            equals=yes
        [/variable]
        [then]
            [terrain]
                terrain=Urfz
                x,y=23,6
            [/terrain]
            [redraw]
                side=1,3,5
            [/redraw]
        [/then]
    [/if]
    [if]
        [variable]
            name=gate3_open
            equals=yes
        [/variable]
        [then]
            [terrain]
                terrain=Fyp
                x,y=45,18
            [/terrain]
            [redraw]
                side=1,3,5
            [/redraw]
        [/then]
    [/if]
    [if]
        [variable]
            name=gate4_open
            equals=yes
        [/variable]
        [then]
            [terrain]
                terrain=Fyp
                x,y=54,15
            [/terrain]
            [redraw]
                side=1,3,5
            [/redraw]
        [/then]
    [/if]
    [if]
        [variable]
            name=turn_number
            greater_than=8
        [/variable]
        [then]
            [terrain]
                terrain=Spay^Vct
                x,y=68,60-61
            [/terrain]
        [/then]
    [/if]
    {FOREACH units_up_above index}
        [unstore_unit]
            variable=units_up_above[$index]
            find_vacant=yes
        [/unstore_unit]
    {NEXT index}
    {CLEAR_VARIABLE units_up_above}
    # this is a hack to prevent game from ending if both real leaders are off map.
    [if]
        [have_unit]
            side={SIDE}
            canrecruit=yes
        [/have_unit]
        [else]
            {MODIFY_UNIT (side={SIDE}) canrecruit yes}
        [/else]
    [/if]
    # and to clean it up afterward
    [if]
        [have_unit]
            id=$leaders_of_side{SIDE}
        [/have_unit]
        [then]
            {MODIFY_UNIT (
                side={SIDE}
                [not]
                    id=$leaders_of_side{SIDE}
                [/not]
                canrecruit=yes
            ) canrecruit no}
        [/then]
    [/if]
#enddef

#define TRI_DARK_PLANET_LOWER FILTER SIDE

    [set_variable]
        name=tri_on_surface
        value=no
    [/set_variable]
#    {TRI_SAVE_SHROUD {SIDE} upper}
    {TRI_SAVE_SHROUD ($player_side) upper}
    [store_unit]
        [filter]
            [not]
                {FILTER}
            [/not]
            [not]
                x,y=recall,recall
            [/not]
        [/filter]
        variable=units_up_above
        kill=yes
    [/store_unit]
#    [modify_side]
#        side={SIDE}
#        shroud=yes
#    [/modify_side]
#    {TRI_RESTORE_SHROUD {SIDE} lower}
    {TRI_RESTORE_SHROUD ($player_side) lower}
    [replace_map]
        map="{~add-ons/Trinity/maps/Dark_Planet_lower.map}"
    [/replace_map]
    [replace_schedule]
        {UNDERGROUND}
    [/replace_schedule]
    [redraw]
        side={SIDE}
    [/redraw]
    [if]
        [variable]
            name=gateA1_open
            equals=yes
        [/variable]
        [then]
            [terrain]
                terrain=Urfz
                x,y=34,5
            [/terrain]
            [redraw]
                side=1,3,5
            [/redraw]
        [/then]
    [/if]
    [if]
        [variable]
            name=gateA2_open
            equals=yes
        [/variable]
        [then]
            [terrain]
                terrain=Urfz
                x,y=31,7
            [/terrain]
            [redraw]
                side=1,3,5
            [/redraw]
        [/then]
    [/if]
    [if]
        [variable]
            name=gateB_open
            equals=yes
        [/variable]
        [then]
            [terrain]
                terrain=Urfz
                x=17,18,19
                y=30,29,29
            [/terrain]
            [redraw]
                side=1,3,5
            [/redraw]
        [/then]
    [/if]
    [if]
        [variable]
            name=gateC_open
            equals=yes
        [/variable]
        [then]
            [terrain]
                terrain=Fyp
                x=46,47
                y=20,21
            [/terrain]
            [redraw]
                side=1,3,5
            [/redraw]
        [/then]
    [/if]
    [if]
        [variable]
            name=gateD_open
            equals=yes
        [/variable]
        [then]
            [terrain]
                terrain=Urb
                x=27-28
                y=38
            [/terrain]
            [redraw]
                side=1,3,5
            [/redraw]
        [/then]
    [/if]
    [if]
        [variable]
            name=gateE_open
            equals=yes
        [/variable]
        [then]
            [terrain]
                terrain=Ur
                x=30-31
                y=33
            [/terrain]
            [redraw]
                side=1,3,5
            [/redraw]
        [/then]
    [/if]
    [if]
        [variable]
            name=gateF_open
            equals=yes
        [/variable]
        [then]
            [terrain]
                terrain=Urfz
                x=15-16
                y=53
            [/terrain]
            [redraw]
                side=1,3,5
            [/redraw]
        [/then]
    [/if]
    {FOREACH units_down_below index}
        [unstore_unit]
            variable=units_down_below[$index]
            find_vacant=yes
        [/unstore_unit]
    {NEXT index}
    {CLEAR_VARIABLE units_down_below}
    # this is a hack to prevent game from ending if both real leaders are off map.
    [if]
        [have_unit]
            side={SIDE}
            canrecruit=yes
        [/have_unit]
        [else]
            {MODIFY_UNIT (side={SIDE}) canrecruit yes}
        [/else]
    [/if]
    # and to clean it up afterward
    [if]
        [have_unit]
            id=$leaders_of_side{SIDE}
        [/have_unit]
        [then]
            {MODIFY_UNIT (
                side={SIDE}
                [not]
                    id=$leaders_of_side{SIDE}
                [/not]
                canrecruit=yes
            ) canrecruit no}
        [/then]
    [/if]
    #    [if]
    #	[have_unit]
    #	    side={SIDE}
    #	[/have_unit]
    #	[else]
    #	[message]
    #	speaker=narrator
    #	message=_"Side "+{SIDE}+" has nobody on this level.  Returning..."
    #	[/message]
    #	{TRI_DARK_PLANET_UPPER ({FILTER}) ({SIDE})}
    #	[/else]
    #    [/if]
#enddef

    # going up/down stairs
#define TRI_DARK_PLANET_DOORWAY SIDE
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side={SIDE}
            [filter_location]
                terrain=*^Uyod
            [/filter_location]
        [/filter]
        [if]
            [variable]
                name=tri_on_surface
                equals=no
            [/variable]
            [then]
                #                [set_variable]
                #                    name=tri_on_surface
                #                    value=yes
                #                [/set_variable]
                {TRI_DARK_PLANET_UPPER (id=$unit.id) ({SIDE})}
            [/then]
            [else]
                #                [set_variable]
                #                    name=tri_on_surface
                #                    value=no
                #                [/set_variable]
                {TRI_DARK_PLANET_LOWER (id=$unit.id) ({SIDE})}
            [/else]
        [/if]
    [/event]
#enddef

    [event]
        name=prestart
        [objectives]
            side=1
            [objective]
                condition=win
                description=_ "Find and Defeat Enemy Leaders"
            [/objective]
            [objective]
                condition=lose
                description=_ "Death of Haldrad"
            [/objective]
            [objective]
                condition=lose
                description=_ "Death of Caldera"
            [/objective]
            note= _"There are two levels to this map, similar to the tower scenario.  Use the right-click menu to manually switch between levels."
        [/objectives]
        [objectives]
            side=3
            [objective]
                condition=win
                description=_ "Find and Defeat Enemy Leaders"
            [/objective]
            [objective]
                condition=lose
                description=_ "Death of Dardrus"
            [/objective]
            [objective]
                condition=lose
                description=_ "Death of Bresda"
            [/objective]
        [/objectives]
        [objectives]
            side=5
            [objective]
                condition=win
                description=_ "Find and Defeat Enemy Leaders"
            [/objective]
            [objective]
                condition=lose
                description=_ "Death of Keldan"
            [/objective]
        [/objectives]
        [recall]
            id=E_Caldera
        [/recall]
        [recall]
            id=Ponce
        [/recall]
        [recall]
            id=Lyron
        [/recall]
        {MODIFY_UNIT (side=3
        [not]
            canrecruit=yes
        [/not]) facing se}
        [store_unit]
            [filter]
                id=Seth
            [/filter]
            variable=seth
            kill=yes
        [/store_unit]
        [set_variable]
            name=leaders_of_side1
            value="Haldrad,E_Caldera"
        [/set_variable]
        [set_variable]
            name=leaders_of_side3
            value="Dardrus,Bresda"
        [/set_variable]
        [set_variable]
            name=leaders_of_side5
            value="Keldan"
        [/set_variable]
        [set_variable]
            name=tri_on_surface
            value=yes
        [/set_variable]
        [set_variable]
            name=player_side
            value=1
        [/set_variable]
        [remove_shroud]
            side=1,3,5
            x,y=1-68,1-68
        [/remove_shroud]
        # sw structure
        [place_shroud]
            side=1,3,5
            x=3-13,4-11,5-12
            y=60-66,59,67
        [/place_shroud]
        # big structure
        [place_shroud]
            side=1,3,5
            x=19-35,39-47,48-53,54-56,13-18
            y=1-11,8-22,15-23,18-22,11-18
        [/place_shroud]
        # this is development stuff that should be removed when possible - these things should have been taken care of in earlier scenarios
        ###############
        #        [clear_menu_item]
        #            id=tri_tower_go_inside
        #        [/clear_menu_item]
        #        [clear_menu_item]
        #            id=tri_tower_go_outside
        #        [/clear_menu_item]
        {CLEAR_VARIABLE e_rat}
        {CLEAR_VARIABLE caldera}
        {CLEAR_VARIABLE leader_s2}
        {CLEAR_VARIABLE leader_s4}
        {CLEAR_VARIABLE leader_s6}
        {CLEAR_VARIABLE leader_s7}
        {CLEAR_VARIABLE dardrus}
        {CLEAR_VARIABLE bresda}
        ############
        # make the initial shroud data for underground cover all
	[store_locations]
	variable=shroud_locs_lower
	x,y=1-68,1-68
	[/store_locations]
	[micro_ai]
	    side=8
	    ai_type=forest_animals
	    action=add
	    deer_type=Lunar Bug,Lunar Mantis,Lunar Worm,Lunar Crab
	    [filter_location]
		terrain=Dsmz
	    [/filter_location]
	[/micro_ai]
    [/event]

    # Haldrad
    [side]
        type=Spearman
        id=Fooby
        name= _ "Fooby"
        side=1
        canrecruit=yes
        controller=human
        fog=no
        shroud=yes
        scroll_to_leader=no
        recruit="Spearman,Bowman,Horseman,Peasant,Ruffian"
        {INCOME 10 7 4}
        {GOLD 390 270 160}
        team_name=Human
    [/side]

    # phantoms, lower
    [side]
        type=Seth
        id=Seth
        name= _ "Seth"
        side=2
        canrecruit=yes
        controller=ai
        fog=no
        shroud=no
        recruit="Tomb Dancer,Tomb Huntress,Tomb Guard,Tomb Shade,Tower Dancer,Tower Servant,Skeleton"
        {INCOME 7 10 14}
        {GOLD 350 450 550}
        team_name=Phantom
        {ai/aliases/stable_singleplayer.cfg}
        [ai]
            {MODIFY_AI_ADD_CANDIDATE_ACTION 2 main_loop (
                [candidate_action]
                    id=push_to_destination
                    engine=fai
                    name=push_to_destination
                    type=movement
                    evaluation="if(me.id='Mech_Seth',{AI_CA_COMBAT_SCORE}+10,0)"
                    action="move(me.loc,choose(unit_moves(me.loc),'mloc',-sum(map(simplest_path(mloc,loc(67,62),me.loc),'path_location', movement_cost( me, path_location ) ))) )"
                [/candidate_action]
            )}
        [/ai]
    [/side]

    # Bresda & Dardrus
    [side]
        type=Spearman
        id=Fooby
        name= _ "Fooby"
        side=3
        canrecruit=yes
        controller=human
        fog=no
        shroud=yes
        recruit=""
        {INCOME 10 7 4}
        {GOLD 360 250 150}
        team_name=Primeval
    [/side]

    # Mechs, lower
    [side]
        no_leader=yes
        side=4
        controller=ai
        fog=no
        shroud=no
        team_name=Phantom
    [/side]

    # Keldan
    [side]
        type=Spearman
        id=Fooby
        name= _ "Fooby"
        side=5
        canrecruit=yes
        controller=human
        fog=no
        shroud=yes
        recruit="Elvish Fighter,Elvish Archer, Elvish Shaman, Elvish Scout"
        {INCOME 10 7 4}
        {GOLD 360 290 190}
        team_name=Phantom
        # because I think the recall list balancing may be all screwed up at this point:
        [unit]
            type=Yak
            x,y=recall,recall
        [/unit]
        [unit]
            type=Orthrus
            x,y=recall,recall
        [/unit]
        [unit]
            type=Noble_Beast
            x,y=recall,recall
        [/unit]
        [unit]
            type=Ophis
            x,y=recall,recall
        [/unit]
        [unit]
            type=Yak
            x,y=recall,recall
        [/unit]
    [/side]

    # Mechs, upper
    [side]
        no_leader=yes
        side=6
        controller=ai
        fog=no
        shroud=no
        team_name=Phantom
        [unit]
            type=Tri_Mech_Mine
            id=Minder
            name="M-742"
            x,y=25,28
        [/unit]
    [/side]

    # phantoms, upper
    [side]
        type=Mummy Pharo
        id=Imambyses
        name= "Imambyses"
        side=7
        canrecruit=yes
        controller=ai
        fog=no
        shroud=no
        recruit="Tomb Guard,Tomb Shade,Tomb Mummy"
        {INCOME 10 15 20}
        {GOLD 350 450 550}
        team_name=Phantom
        [unit]
            type=Mummy King
            id=Aramhotep
            name="Aramhotep"
            canrecruit=yes
            x,y=33,29
        [/unit]
    [/side]

    # Monsters, upper
    [side]
        no_leader=yes
        side=8
        controller=ai
        fog=no
        shroud=no
        team_name=Monsters
    [/side]

    ##############################################################
    #### general events, no chronology
    ###########################################################3

    {ARCHAIC_KHTHON_RECRUITS (
        side=5
        [not]
            type=Horse
        [/not]
    )}

    # for the "irradiated" status and terrain effect
    {TRI_RADIOACTIVE}

    [event]
        name=recall
        [filter]
            side=1
            race=orc
        [/filter]
        [message]
            speaker=unit
            message=_"Haha!  I must be the first orc to set foot on this new land!  ...  Hmmm ...  It's a cursed land - I think I like my homeland better, despite all the ice."
        [/message]
    [/event]

    [event]
        name=recall
        [filter]
            side=1
            race=dwarf
        [/filter]
        [message]
            speaker=unit
            message=_"It may be one small step for a man, orc, or elf, but it's one giant step for dwarf kin!  Ah...  Hrmh...  This place is dark and rocky like a cave, but it is drier and more open...  I don't like it."
        [/message]
    [/event]

    # Keldan's Minder, Seth isn't very trusting
    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=Keldan
        [/filter]
        [filter_condition]
            [have_unit]
                id=Minder
            [/have_unit]
        [/filter_condition]
        {MOVE_UNIT (id=Minder) $x1 $y1}
    [/event]

    # spawning robots
    [event]
        #        name=side 4 turn # this fires after map_check event below, so we have to get around that somehow...
        name=side turn
        first_time_only=no
        [filter_condition]
            [variable]
                name=in_basement
                greater_than=0
            [/variable]
            [variable]
                name=side_number
                equals=4
            [/variable]
        [/filter_condition]
        [if]
            [variable]
                name=tri_on_surface
                equals=yes
            [/variable]
            [then]
                [set_variable]
                    name=must_return_to_surface
                    value=yes
                [/set_variable]
                {TRI_DARK_PLANET_LOWER (id=dummy) (1)} # FLAG: shroud data requires this SIDE to be correct, and there will be cases when Side 1 is incorrect
                [if]
                    [have_unit]
                        side=4
                        count=0-1
                    [/have_unit]
                    [then]
                        [terrain]
                            terrain=Fyp
                            x=36,39,39-40
                            y=41,44,50
                        [/terrain]
                        [redraw][/redraw]
                        [unit]
                            type=Tri_Mech_Drone
                            side=4
                            x,y=38,40
                        [/unit]
                        [unit]
                            type=Tri_Mech_Drone
                            side=4
                            x,y=41,43
                        [/unit]
                        [unit]
                            type=Tri_Mech_Defender
                            side=4
                            x,y=41,49
                        [/unit]
                    [/then]
                [/if]
                [event] # do I need FTO=no for this nested event?
                    name=side 4 turn end
                    first_time_only=no
                    [filter_condition]
                        [variable]
                            name=must_return_to_surface
                            equals=yes
                        [/variable]
                    [/filter_condition]
                    {CLEAR_VARIABLE must_return_to_surface}
                    {TRI_DARK_PLANET_UPPER (id=dummy) (1)}
                [/event]
            [/then]
            [else]
                [if]
                    [have_unit]
                        side=4
                        count=0-1
                    [/have_unit]
                    [then]
                        [terrain]
                            terrain=Fyp
                            x=36,39,39-40
                            y=41,44,50
                        [/terrain]
                        [redraw][/redraw]
                        [unit]
                            type=Tri_Mech_Drone
                            side=4
                            x,y=38,40
                        [/unit]
                        [unit]
                            type=Tri_Mech_Drone
                            side=4
                            x,y=41,43
                        [/unit]
                        [unit]
                            type=Tri_Mech_Defender
                            side=4
                            x,y=41,49
                        [/unit]
                    [/then]
                [/if]
            [/else]
        [/if]
    [/event]
    # trying to keep track if someone is entering or leaving that region
    [event]
        name=exit_hex
        first_time_only=no
        [filter]
            side=1,3,5
            x,y=16,49
        [/filter]
        [allow_undo][/allow_undo]
        [if]
            [variable]
                name=tri_on_surface
                equals=yes
            [/variable]
            [then]
                [set_variable]
                    name=in_basement
                    add=-1
                [/set_variable]
            [/then]
            [else]
                [set_variable]
                    name=in_basement
                    add=1
                [/set_variable]
            [/else]
        [/if]
    [/event]

    # going up/down stairs
    {TRI_DARK_PLANET_DOORWAY 1}
    {TRI_DARK_PLANET_DOORWAY 3}
    {TRI_DARK_PLANET_DOORWAY 5}

    # I'm not sure I really need this...
#ifdef __UNUSED__
    # put the unit on the list, if it isn't already on there
    [event]
        name=select,recall,recruit # should catch everybody
        first_time_only=no
        [filter]
            side=$side_number
        [/filter]
        [filter_condition]
            [not]
                [variable]
                    name=tri_dp_unit_list_var_$side_number|
                    contains=$unit.id
                [/variable]
            [/not]
        [/filter_condition]
        [set_variables]
            name=tri_dp_unit_list_$side_number|
            mode=append
            [value]
                id=$unit.id
            [/value]
        [/set_variables]
        {CLEAR_VARIABLE tri_dp_unit_list_var_$side_number|}
        [set_variable]
            name=tri_dp_unit_list_var_$side_number|
            [join]
                variable=tri_dp_unit_list_$side_number
                key=id
                separator=","
            [/join]
        [/set_variable]
    [/event]

    # update the unit list
    # define TRI_DP_UNIT_LIST_UPDATE SIDE
    [event]
        name=die
        first_time_only=no
        [filter]
            side={SIDE}
        [/filter]
        {LOOKUP_INDEX tri_dp_unit_list_{SIDE} id $unit.id u_index}
        {CLEAR_VARIABLE tri_dp_unit_list_{SIDE}[$u_index]}
        {CLEAR_VARIABLE tri_dp_unit_list_var_{SIDE}}
        [set_variable]
            name=tri_dp_unit_list_var_{SIDE}
            [join]
                variable=tri_dp_unit_list_{SIDE}
                key=id
                separator=","
            [/join]
        [/set_variable]
    [/event]
    # enddef

    {TRI_DP_UNIT_LIST_UPDATE 1}
    {TRI_DP_UNIT_LIST_UPDATE 3}
    {TRI_DP_UNIT_LIST_UPDATE 5}
#endif
    # end of __UNUSED__

    # this is to keep units from getting stuck after the upper/lower transition
    [event]
        name=new turn
        first_time_only=no
        [if]
            [variable]
                name=tri_on_surface
                equals=yes
            [/variable]
            [then]
                {FOREACH units_down_below index}
                    [set_variable]
                        name=units_down_below[$index].moves
                        value=$units_down_below[$index].max_moves
                    [/set_variable]
                    [set_variable]
                        name=units_down_below[$index].attacks_left
                        value=$units_down_below[$index].max_attacks
                    [/set_variable]
                {NEXT index}
            [/then]
            [else]
                {FOREACH units_up_above index}
                    [set_variable]
                        name=units_up_above[$index].moves
                        value=$units_up_above[$index].max_moves
                    [/set_variable]
                    [set_variable]
                        name=units_up_above[$index].attacks_left
                        value=$units_up_above[$index].max_attacks
                    [/set_variable]
                {NEXT index}
            [/else]
        [/if]
    [/event]

    # check to see if current side has units on other map
    # the player has a chance to use the menu.  The AI doesn't, but if an AI side is not straddling both maps, it's OK
    [event]
        name=side turn
        first_time_only=no
        [filter_condition]
            [not]
                [have_unit] # I can't remember if this checks recall list? Does not seem to
                    side=$side_number
                [/have_unit]
            [/not]
            # ifdef __UNUSED__
            [and]
                [variable]
                    name=units_down_below.length
                    greater_than=0
                [/variable]
                [or]
                    [variable]
                        name=units_up_above.length
                        greater_than=0
                    [/variable]
                [/or]
            [/and]
            # endif
        [/filter_condition]
#        [message]
#            speaker=narrator
#            message="Map Check event for side $side_number|"
#        [/message]
        [if]
            [variable]
                name=tri_on_surface
                equals=yes
            [/variable]
            [then]
                {LOOKUP_INDEX units_down_below side $side_number found_index}
                [if]
                    [variable]
                        name=found_index
                        equals=$units_down_below.length
                    [/variable]
                    [then]
#                        [message]
#                            speaker=narrator
#                            message="No units for this side found on units_down_below."
#                        [/message]
                    [/then]
                    [else]
#                        [message]
#                            speaker=narrator
#                            message="Found this side's units in units_down_below.  Firing DARK_PLANET_LOWER..."
#                        [/message]
#                        [set_variable]
#                            name=tri_on_surface
#                            value=no
#                        [/set_variable]
                        {TRI_DARK_PLANET_LOWER (id=dummy) ($side_number)}
                    [/else]
                [/if]
            [/then]
            [else]
                {LOOKUP_INDEX units_up_above side $side_number found_index}
                [if]
                    [variable]
                        name=found_index
                        equals=$units_up_above.length
                    [/variable]
                    [then]
#                        [message]
#                            speaker=narrator
#                            message="No units for this side found on units_up_above."
#                        [/message]
                    [/then]
                    [else]
#                        [message]
#                            speaker=narrator
#                            message="Found this side's units in units_up_above.  Firing DARK_PLANET_UPPER..."
#                        [/message]
                        #			[set_variable]
                        #			name=tri_on_surface
                        #			value=yes
                        #			[/set_variable]
                        {TRI_DARK_PLANET_UPPER (id=dummy) ($side_number)}
                    [/else]
                [/if]
            [/else]
        [/if]
    [/event]

#ifdef __UNUSED__
    # make sure we check both levels on a new side turn
    # for now, this should be enough, because the AI sides cannot traverse the stairs - side 2 & 4 is always below, side 6 & 7 above
    # that restriction is not ideal, and this should be changed.
    # what happens if player has nobody on map at beginning of turn, do they lose before this is fired?
    # no, but they lose anyway...  I'm just going to have to bite the bullet and go with the event above.
    # so I'm going to __UNUSED__ it for now.
    [event]
        #            name=fooby
        name=side turn
        first_time_only=no
        [filter_condition]
            [not]
                [have_unit]
                    side=$side_number
                [/have_unit]
            [/not]
        [/filter_condition]
        [if]
            [variable]
                name=tri_on_surface
                equals=yes
            [/variable]
            [then]
                #                [set_variable]
                #                    name=tri_on_surface
                #                    value=no
                #                [/set_variable]
#                [message]
#                    speaker=narrator
#                    message= _ "Firing DARK_PLANET_LOWER on side $side_number|"
#                [/message]
                {TRI_DARK_PLANET_LOWER (id=dummy) ($side_number)}
            [/then]
            [else]
                #                [set_variable]
                #                    name=tri_on_surface
                #                    value=yes
                #                [/set_variable]
#                [message]
#                    speaker=narrator
#                    message= _ "Firing DARK_PLANET_UPPER on side $side_number|"
#                [/message]
                {TRI_DARK_PLANET_UPPER (id=dummy) ($side_number)}
            [/else]
        [/if]
    [/event]
#endif

    [event]
        name=side 3 turn
        [filter_condition]
            [have_unit]
                id=Mech_D
            [/have_unit]
        [/filter_condition]
        [unstore_unit]
            variable=dardrus
        [/unstore_unit]
        [unstore_unit]
            variable=bresda
        [/unstore_unit]
        {CLEAR_VARIABLE dardrus}
        {CLEAR_VARIABLE bresda}
        [remove_shroud]
            side=1,3,5
            x,y=2-14,57-68
        [/remove_shroud]
        [recall]
            side=3
        [/recall]
        [unit]
            side=3
            type=Primeval Swiftfoot
            id=Tanyche
            name=Tanyche
            profile=portraits/tanyche.png
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            x,y=5,67
            facing=ne
        [/unit]
        [redraw]
            side=3
        [/redraw]
        [message]
            speaker=Bresda
            message=_"Where are we?"
        [/message]
        [message]
            speaker=Dardrus
            message=_"I don't know, but I recognize some of the architecture.  This is territory of The Pantheon, or at least it once was."
        [/message]
        {MODIFY_UNIT (id=Bresda) facing se}
        [message]
            speaker=Bresda
            message=_"That's fascinating..."
        [/message]
        {MOVE_UNIT (id=Bresda) 12 66}
        {MODIFY_UNIT (id=Bresda) facing se}
        [message]
            speaker=Bresda
            message=_"How do we open these doors and get out?"
        [/message]
        # actually, you can bring in Tanyche here, instead of this
        #        [message]
        #            speaker=narrator
        #            image=portraits/seth.png~O(0.5)
        #            caption=Seth
        #            message= _ "Allow me..."
        #        [/message]
        [message]
            speaker=Tanyche
            message=_"You have come!  Let us go!"
        [/message]
        {MOVE_UNIT (id=Tanyche) 13 66}
        [set_variable]
            name=gate1_open
            value=yes
        [/set_variable]
        [terrain]
            terrain=Urb
            x=13,14
            y=67,66
        [/terrain]
        [redraw][/redraw]
        [message]
            speaker=Dardrus
            message=_"Who are you?"
        [/message]
        [message]
            speaker=Tanyche
            message=_"Why, I am the scout to guide you, the vanguard of our revenge against the pilot!"
        [/message]
        [message]
            speaker=Bresda
            message=_"(Dardrus, what is she talking about?)"
        [/message]
        [message]
            speaker=Dardrus
            message=_"(I have no idea...)"
        [/message]
        [message]
            speaker=Tanyche
            message=_"What are you waiting for?  You <i>are</i> our vanguard, are you not?"
        [/message]
        [message]
            speaker=Dardrus
            message=_"Yes, of course we are!  Now, let us find and destroy this ... pilot."
        [/message]
        [message]
            speaker=Tanyche
            message=_"We'll need to get to the lower level of the main structure to the north."
        [/message]
    [/event]

    # this won't work if the player has found a way underground, but that shouldn't be possible yet
    # this could also be the branch point - in fact, I think it will be
    [event]
        name=side 1 turn
        [filter_condition]
            [have_unit]
                id=Dardrus
            [/have_unit]
        [/filter_condition]
        [message]
            speaker=E_Caldera
            message=_"So, my red-eyed enemies are here...  <i>Keldan, we will soon be trapped between a hammer and an anvil, if we don't act now...</i>"
        [/message]
        [message]
            speaker=Keldan
            message=_"<i>Yes, Echidna.  What do you wish me to do?</i>"
        [/message]
        [message]
            speaker=E_Caldera
            message=_"<i>Create a distraction...</i>"
        [/message]
        [message]
            speaker=Keldan
            message=_"<i>As you command.</i>"
        [/message]
        [message]
            speaker=Keldan
            message=_"So, Red-eyed daemon!  You have joined our little adventure!  No doubt you have come to the aid of your evil master!  Prince, we must destroy these newcomers!"
        [/message]
        [kill]
            id=E_Caldera
        [/kill]
        [message]
            speaker=Bresda
            message=_"(What is <i>he</i> doing here?)"
        [/message]
        [message]
            speaker=Dardrus
            message=_"Prince Haldrad!  Don't be fooled, we are not enemies!  It is the green-eyed ones such as him that are not to be trusted."
        [/message]
        [message]
            speaker=Haldrad
            message=_"It has been a while, Dardrus, and you did leave me in prison.  But I still trust you more than these evil elves, let us join forces."
        [/message]
        [message]
            speaker=Ponce
            message=_"Speaking of 'trust', where did the Queen go?"
        [/message]
        [unit]
            side=5
            type=AR_Owl
            x,y=66,64
	    facing=nw
	[/unit]
        [unit]
            side=5
            type=AR_Owl
            x,y=68,64
	    facing=nw
	[/unit]
        [unit]
            side=5
            type=AR_LittleThing
            x,y=67,63
	    facing=nw
	[/unit]
        [unit]
            side=5
            type=Weasadillo
            x,y=67,64
	    facing=nw
	[/unit]
	{ARCHAIC_KHTHONIZED (x=66,68,67,67
			     y=64,64,63,64)}
        [unit]
            side=5
            type=Echidna_Queen
            x,y=68,63
            id=Echidna
            name=Echidna
            facing=nw
            canrecruit=yes
        [/unit]
        [message]
            speaker=Echidna
            message=_"I'm right here!  I need this Sceptre, <i>'my son'</i>, you shall soon understand..."
        [/message]
        [message]
            speaker=narrator
            image=portraits/seth.png~O(0.5)
            caption=Seth
            message= _ "No, Echidna...  We are not here for your amusement - you shall join me..."
        [/message]
        {MODIFY_UNIT (id=Echidna) facing nw}
        [message]
            speaker=Echidna
            message=_"You've made a mistake in your little game, Seth!  You thought to lure me in, but you are getting weaker, while I've grown stronger!"
        [/message]
        [set_recruit]
            side=5
            recruit=""
        [/set_recruit]
        [set_extra_recruit]
            id=Keldan
            extra_recruit="Elvish Fighter,Elvish Archer, Elvish Shaman, Elvish Scout"
        [/set_extra_recruit]
        [set_extra_recruit]
            id=Echidna
            extra_recruit="Spearman,Bowman,Horse,Peasant,Ruffian"
        [/set_extra_recruit]
        [gold]
            side=5
            amount=320
        [/gold]
        [message]
            speaker=narrator
            message=_"With the Khthon forces openly flying their flag once again, the battle became a three-way struggle for control of the battlefield, (<i>and all that jazz, etc. fix this</i>).  That Seth and his lifeless minions could not be allowed to triumph was clear, but which of the others could most likely defeat them?"
            # need to update objectives
            [option]
                message=_"The Khthon stand the best chance. <span color='#FF0000'> This branch not yet written.</span>"
                [command]
                    [set_variable]
                        name=branch
                        value=khthon
                    [/set_variable]
		        [set_variable]
		            name=player_side
		            value=5
		        [/set_variable]
                    [modify_side]
                        side=1
                        controller=ai
                        team_name=Primeval
                    [/modify_side]
                    [modify_side]
                        side=3
                        controller=ai
                        team_name=Primeval
                    [/modify_side]
                    [modify_side]
                        side=5
                        controller=human
                        team_name=Khthon
                    [/modify_side]
                    [objectives]
                        side=5
                        [objective]
                            condition=win
                            description=_ "Capture Human Leaders"
                        [/objective]
                        [objective]
                            condition=win
                            description=_ "Defeat Primevalist Leaders"
                        [/objective]
                        [objective]
                            condition=lose
                            description=_ "Death of Keldan"
                        [/objective]
                        [objective]
                            condition=lose
                            description=_ "Death of Echidna"
                        [/objective]
                    [/objectives]
                [/command]
            [/option]
            [option]
                message=_"The Khthon are just as bad as Seth, victory must go to the humans and Primevals."
                [command]
                    [set_variable]
                        name=branch
                        value=primeval
                    [/set_variable]
                    [modify_side]
                        side=1
                        controller=human
                        team_name=Primeval
                    [/modify_side]
                    [modify_side]
                        side=3
                        controller=human
                        team_name=Primeval
                    [/modify_side]
                    [modify_side]
                        side=5
                        controller=ai
                        team_name=Khthon
                    [/modify_side]
                    [objectives]
                        side=1
                        [objective]
                            condition=win
                            description=_ "Defeat Khthon Leaders"
                        [/objective]
                        [objective]
                            condition=lose
                            description=_ "Death of Haldrad"
                        [/objective]
                        [objective]
                            condition=lose
                            description=_ "Death of Ponce"
                        [/objective]
                        [objective]
                            condition=lose
                            description=_ "Death of Lyron"
                        [/objective]
                    [/objectives]
                    [objectives]
                        side=3
                        [objective]
                            condition=win
                            description=_ "Defeat Khthon Leaders"
                        [/objective]
                        [objective]
                            condition=lose
                            description=_ "Death of Dardrus"
                        [/objective]
                        [objective]
                            condition=lose
                            description=_ "Death of Bresda"
                        [/objective]
                    [/objectives]
                [/command]
            [/option]
        [/message]
    [/event]

#define BRANCH_PRIMEVAL
    [filter_condition]
        [variable]
            name=branch
            equals=primeval
        [/variable]
    [/filter_condition]
#enddef

#define BRANCH_KHTHON
    [filter_condition]
        [variable]
            name=branch
            equals=khthon
        [/variable]
    [/filter_condition]
#enddef

    [event]
        # this mimics a recruiting side, the spawning stops once there are a certain number of units on the map
        name=new turn
        first_time_only=no
        [filter_condition]
            [variable]
                name=spawn_side_6
                equals=yes
            [/variable]
        [/filter_condition]
        [set_variable]
            name=mech_type
            rand=Tri_Mech_Drone,Tri_Mech_Drone,Tri_Mech_Drone,Tri_Mech_Defender,Tri_Mech_Defender,Tri_Mech_Sentinel
        [/set_variable]
        [unit]
            type=Tri_Mech_Drone
            side=6
            x,y=49,36
            facing=nw
        [/unit]
        [unit]
            type=Tri_Mech_Drone
            side=6
            x,y=50,35
            facing=nw
        [/unit]
        [unit]
            type=$mech_type
            side=6
            x,y=50,36
            facing=nw
        [/unit]
        [unit]
            type=Tri_Mech_Defender
            side=6
            x,y=51,36
            facing=nw
        [/unit]
        {CLEAR_VARIABLE mech_type}
        [if]
            [have_unit]
                side=6
                count=9-99 # this can be changed, for difficulty levels and balancing
            [/have_unit]
            [then]
                {CLEAR_VARIABLE spawn_side_6}
            [/then]
        [/if]
    [/event]

    ###############################################################
    # start of chronological events
    # moveto events are after these
    ###############################################################

    [event]
        name=start
        # because Keldan might be missing, bug in an earlier scenario
        [music]
            name="casualties_of_war.ogg"
            immediate=yes
            append=no
        [/music]
        [if]
            [have_unit]
                id=Keldan
            [/have_unit]
            [else]
                [unit]
                    side=5
                    type=Keldan
                    name=Keldan
                    id=Keldan
                    canrecruit=yes
                    x,y=25,29
                    experience=35
                [/unit]
            [/else]
        [/if]
        # recall/leaders for side 3 were also screwed up, this is a patch
        # the tower scenario needs to be fixed
        [recall]
            id=Bresda
        [/recall]
        [recall]
            id=Dardrus
        [/recall]
        {FOREACH leader_3 index}
            [if]
                [have_unit]
                    id=$leader_3[$index].id
                [/have_unit]
                [then]
                    #	            [message]
                    #	                id=$leader_3[$index].id
                    #	                message= _ "I had a clone!"
                    #	            [/message]
                    {CLEAR_VARIABLE leader_3[$index]}
                [/then]
                [else]
                    [unstore_unit]
                        variable=leader_3[$index]
                        x,y=7,63
                        find_vacant=yes
                    [/unstore_unit]
                    #            [message]
                    #                id=$leader_3[$index].id
                    #                message= _ "Unstored"
                    #            [/message]
                [/else]
            [/if]
        {NEXT index}
        {MODIFY_UNIT (canrecruit=yes
        side=3
        [not]
            id=Bresda,Dardrus
        [/not]) canrecruit no}
        [message]
            speaker=Keldan
            message= _ "I see movement in that strange ice-mountain."
        [/message]
        [message]
            speaker=narrator
            image=portraits/seth.png~O(0.5)
            caption=Seth
            message= _ "Those are the enemy.  I sense... We must lure them into my chambers.  For now, assist my Ancient Servants and put up a good fight, until I give the signal."
        [/message]
        [message]
            speaker=Keldan
            message= _ "As you wish."
        [/message]
        [modify_side]
            side=3
            controller=ai
        [/modify_side]
        [modify_side]
            side=5
            controller=ai
        [/modify_side]
        # there are two dardrus being created...
        # because he was a variable and on recall.  see above.
        [store_unit]
            [filter]
                id=Dardrus
            [/filter]
            variable=dardrus
            kill=yes
        [/store_unit]
        [store_unit]
            [filter]
                id=Bresda
            [/filter]
            variable=bresda
            kill=yes
            #                kill=no
        [/store_unit]
        {PUT_TO_RECALL_LIST (side=3)}
        [message]
            speaker=E_Caldera
            message= _ "There, we need to get into the larger building!"
        [/message]
        [message]
            speaker=Haldrad
            message= _ "Hrm...  I see the Elves, or whatever used to be Elves, have beat us here!"
        [/message]
        {MODIFY_UNIT (id=E_Caldera) facing nw}
        [message]
            speaker=E_Caldera
            message= _ "Really!  I did not expect to see them here.  <i>(mutters: What in all the void is Keldan doing here?)</i> "
        [/message]
        {MODIFY_UNIT (id=Ponce) facing nw}
        [message]
            speaker=Ponce
            message= _ "Who did you expect to see?"
        [/message]
        [message]
            speaker=E_Caldera
            message= _ "Just more of those who fought us at the Tower Ruins.  We are clearly fighting forces the likes of which we have never seen, we should make use of every weapon we have!  Haldrad, my son, let me have the Sceptre, I- "
        [/message]
        [message]
            speaker=Haldrad
            message= _ "No!  Mother, we've gone over this several times already!  The Sceptre stays hidden and under my control until I know more about our situation."
        [/message]
        [message]
            speaker=Lyron
            message= _ "Should I put her in the brig, Your Excellency?"
        [/message]
        [message]
            speaker=E_Caldera
            message= _ "Why are you so eager to get me out of the way, <i>Advisor</i>?!"
        [/message]
        [message]
            speaker=Keldan
            message= _ "(They squabble amongst themselves...  Can they not be united even in this battle?  ... Seth will surely triumph.)"
        [/message]
        [set_menu_item]
            id=tri_dp_go_below
            description = _"Go to Underground Map"
            image=icons/action/ornate_play_turn_25-pressed.png~CS(-50,-50,100)
            [show_if]
                [variable]
                    name=tri_on_surface
                    equals=yes
                [/variable]
                # Is this sort of thing needed?  For now, I am not keeping a list, should I?
                #                [not]
                #                    [have_unit]
                #                        id=$tri_tower_unit_list_var
                #                        count=$tri_tower_unit_list.length
                #                    [/have_unit]
                #                [/not]
            [/show_if]
            [command]
                [set_variable]
                    name=tri_on_surface
                    value=no
                [/set_variable]
                # Q: Is $side_number going to cause trouble?  Some delayed variable substitution thing?
                # A: test
                {TRI_DARK_PLANET_LOWER (id=dummy) ($side_number)}
                # this is because the option to check out the other level is available even if nobody is there
                [if]
                    [have_unit]
                        side=$side_number
                    [/have_unit]
                    [else]
#                        [message]
#                            speaker=narrator
#                            message=_"Side "+ $side_number| +" has nobody down here.  Returning to surface..."
#                        [/message]
                        #                        [set_variable]
                        #                            name=tri_on_surface
                        #                            value=yes
                        #                        [/set_variable]
                        {TRI_DARK_PLANET_UPPER (id=dummy) ($side_number|)}
                    [/else]
                [/if]
            [/command]
        [/set_menu_item]
        [set_menu_item]
            id=tri_dp_go_above
            description = _"Go to Surface Map"
            image=icons/action/ornate_play_turn_25-pressed.png~GS()
            [show_if]
                [variable]
                    name=tri_on_surface
                    equals=no
                [/variable]
            [/show_if]
            [command]
                #                [set_variable]
                #                    name=tri_on_surface
                #                    value=yes
                #                [/set_variable]
                {TRI_DARK_PLANET_UPPER (id=dummy) ($side_number)}
                # this is because the option to check out the other level is available even if nobody is there
                [if]
                    [have_unit]
                        side=$side_number
                    [/have_unit]
                    [else]
#                        [message]
#                            speaker=narrator
#                            message=_"Side "+ $side_number| +" has nobody up here.  Returning to lower level..."
#                        [/message]
                        #                        [set_variable]
                        #                            name=tri_on_surface
                        #                            value=no
                        #                        [/set_variable]
                        {TRI_DARK_PLANET_LOWER (id=dummy) ($side_number|)}
                    [/else]
                [/if]
            [/command]
        [/set_menu_item]
    [/event]

    [event]
        name=turn 6
        {FOREACH skm_survivors index}
            [unstore_unit]
                variable=skm_survivors[$index]
                find_vacant=yes
                x,y=68,62
            [/unstore_unit]
        {NEXT index}
        {CLEAR_VARIABLE skm_survivors}
        # debugging stuff, this should be deleted when possible
        [if]
            [have_unit]
                id=Kerrnyn
            [/have_unit]
            [else]
                [unit]
                    side=3
                    type=Primevalist Fighter
                    id=Kerrnyn
                    name=Kerrnyn
                    experience=29
                    x,y=68,62
                [/unit]
                [unit]
                    side=3
                    type=Tri_Bronze_Bird
                    experience=14
                    x,y=68,61
                [/unit]
            [/else]
        [/if]
        {MODIFY_UNIT (id=Kerrnyn) canrecruit no}
        {MODIFY_UNIT (id=Kerrnyn) facing nw}
        [message]
            speaker=Kerrnyn
            message=_"Who are you!?"
        [/message]
        {MODIFY_UNIT (id=Ponce) facing se}
        [message]
            speaker=Ponce
            message=_"No, who are you?"
        [/message]
        [message]
            speaker=Kerrnyn
            message=_"I am a loyal servant to the winged Goddess of Vengeance!  If you are friends, I offer my allegience, but if you are her foes, I bring sharp steel!  Again, who are you?"
        [/message]
        [message]
            speaker=narrator
            image=wesnoth-icon.png
            message=_"The disheveled fighter's gaze lingered on Queen Caldera for a moment, as if he recognized her, then he turned his eyes back to the one who had addressed him."
        [/message]
        [message]
            speaker=Ponce
            message=_"Winged goddess, huh?  If she is the one who-"
        [/message]
        [message]
            speaker=Haldrad
            message=_"Easy, Sir Ponce!  We have no quarrel with the Goddess of Vengeance, Stranger-"
        [/message]
        [message]
            speaker=Lyron
            message=_"Indeed, an enemy of the Goddess of Vengeance is an enemy of ours!"
        [/message]
        [message]
            speaker=Kerrnyn
            message=_"Glad I am to hear that, this has been a very strange day...  Let us kill some green-eyed daemons!"
        [/message]
        #	{MODIFY_UNIT (id=Kerrnyn) side 1}
        {MODIFY_UNIT (x,y=66-68,60-64) side 1}
    [/event]

    [event]
        name=turn 7
        [message]
            speaker=Lyron
            message=_"So tell me, faithful servant of the Goddess, where were you hiding?  Why did we not see you, and are there any others?"
        [/message]
        [message]
            speaker=Ponce
            message=_"(I knew I should have pushed us to follow the blood-trails...)"
        [/message]
        [message]
            speaker=Kerrnyn
            message=_"My name is Kerrnyn.  I was alone, save for my Goddess and her brass-winged agents.  I was tricked by a green-eyed daemon into the Ice Mountain, where it wanted to assassinate Her!  But we were too strong for the daemon, and Our Goddess crashed the mountain into the daemon's infernal tower.  After that, I don't remember so much...  But now we're here, so let's finish this and make Our Goddess proud!"
        [/message]
        [message]
            speaker=Lyron
            message=_"I see...  So there are no reinforcements coming?  Prince Haldrad, now you know where we stand..."
        [/message]
        [message]
            speaker=Kerrnyn
            message=_"Well, there was some water stored in the back chambers, just follow the light-colored tiles..."
        [/message]
        [message]
            speaker=Haldrad
            message=_"Really!  Thank you-"
        [/message]
        [message]
            speaker=Lyron
            message=_"<i>Brother</i> Kerrnyn!  This is valuable information you give, and Our Goddess shall be proud of your efforts!"
        [/message]
        [message]
            speaker=Kerrnyn
            message=_"I sense you mock me...  Do you really serve Our Goddess?"
        [/message]
        [message]
            speaker=Haldrad
            message=_"Kerrnyn, it is true, we are not of your faith...  But I have fought side-by-side with a man of your goddess's stock, I considered him my friend.  Believe me when I say we are united in purpose to destroy the green-eyed daemons!"
        [/message]
        [message]
            speaker=Kerrnyn
            message=_"I see...  It is all I could hope for, I'm sure my Goddess will forgive me if I share the supplies that I know are in the mountain...  I shall return."
        [/message]
        {MOVE_UNIT (id=Kerrnyn) 68 61}
        [store_unit]
            [filter]
                id=Kerrnyn
            [/filter]
            variable=kerrnyn
            kill=yes
        [/store_unit]
        [message]
            speaker=narrator
            message=_"Haldrad and his officers exchanged glances, but he decided to give the crazed fighter a chance to return of his own accord."
        [/message]
    [/event]

    [event]
        name=turn 8
        [unstore_unit]
            variable=kerrnyn
        [/unstore_unit]
        {CLEAR_VARIABLE kerrnyn}
        {MODIFY_UNIT (id=Kerrnyn) facing nw}
        [terrain]
            terrain=Spay^Vct
            x,y=68,60-61
        [/terrain]
        [redraw][/redraw]
        [message]
            speaker=Lyron
            message=_"Look who's back..."
        [/message]
        [message]
            speaker=Kerrnyn
            message=_"Yes, I'm back, with supplies!  The Goddess had instructed us on how to clean and dress wounds, these two medical tents have all the instruments needed for that."
        [/message]
        [gold]
            side=1
            amount=280 # should be difficulty graded
        [/gold]
    [/event]
    ########################
    # events triggered by positions on map or attacks
    ##########################

    [event]
        name=attack_end
        [filter]
            side=1,5
        [/filter]
        [filter_second]
            side=1,5
        [/filter_second]
        [message]
            speaker=E_Caldera
            message=_"Stop this!  Why are we fighting?"
        [/message]
        [store_unit]
            [filter]
                id=Keldan
            [/filter]
            variable=keldan
            kill=no
        [/store_unit]
        {MOVE_UNIT (id=E_Caldera) $keldan.x $keldan.y}
        # need to have something to check which way she should face
        [message]
            speaker=E_Caldera
            message=_"(*hisses*<i>Keldan, look at me!</i>)"
        [/message]
        [message]
            speaker=Keldan
            message=_"...  Echidna?  Is that you?"
        [/message]
        # this could be the branch point, but for now, I will play it straight
        [message]
            speaker=narrator
            message=_"Keldan felt very conflicted.  He knew Seth's promise was empty, so he was biding his time to see if there was another possible winning side.  The part of him that was still Elf wanted that side to be the human-led defenders, and strike down both Seth and Echidna.  The part of him that was Khthon wanted to rejoin Echidna, defeat Seth and consume the humans..."
        [/message]
        [message]
            speaker=Keldan
            message=_"Keep your cover for now, I will-"
        [/message]
        {FLASH_RED (
            [music]
                name=legends_of_the_north.ogg
                immediate=no
                append=no
            [/music]
            [message]
                speaker=Minder
                message=_"ALERT!  Betrayal!  ALERT-"
            [/message]
        )}
        [message]
            speaker=Keldan
            message=_"Silence you!"
        [/message]
        [animate_unit]
            flag=attack
            [filter]
                id=Keldan
            [/filter]
            hits=yes
            [primary_attack]
                name=sword
            [/primary_attack]
            [facing]
                [filter_adjacent_location]
                    [filter]
                        id=Minder
                    [/filter]
                [/filter_adjacent_location]
            [/facing]
        [/animate_unit]

        [kill]
            id=Minder
            animate=yes
        [/kill]
        {CLEAR_VARIABLE keldan}
        [message]
            speaker=Keldan
            message=_"Damnation!  They see my true colors!  Human Prince, I fight for you now!  We are enemies, and I'll admit I razed your capitol, but we must unite now to confront this threat!"
        [/message]
        [message]
            speaker=Haldrad
            message=_"You seem to have the trust of my mother. (<i> Or whoever that is...</i>)  I accept your offer, let us join forces for now."
        [/message]
        [modify_side]
            side=5
            team_name=Human
            controller=human
        [/modify_side]
        [gold]
            side=5
            amount=60
        [/gold]
        [unit]
            type=Tri_Mech_Drone
            side=6
            x,y=49,36
            facing=nw
        [/unit]
        [unit]
            type=Tri_Mech_Drone
            side=6
            x,y=50,35
            facing=nw
        [/unit]
        [unit]
            type=Tri_Mech_Drone
            side=6
            x,y=50,36
            facing=nw
        [/unit]
        [unit]
            type=Tri_Mech_Defender
            side=6
            x,y=51,36
            facing=nw
        [/unit]
        [message]
            x,y=51,36
            message=_"The slaves revolt!  Seek and destroy!"
        [/message]
        [message]
            id=Imambyses
            message=_"Indeed...  We no longer require your services, Keldan ..."
        [/message]
        [set_variable]
            name=spawn_side_6
            value=yes
        [/set_variable]
        [music]
            name=battle.ogg
            append=no
            immediate=yes
        [/music]
    [/event]

    [event]
        name=die
        [filter]
            id=Imambyses
        [/filter]
        [message]
            side=1
            message=_"The enemy generals are falling, we are winning!"
        [/message]
        [message]
            speaker=narrator
            image=portraits/seth.png~O(0.5)
            caption=Seth
            message= _ "Your <i>arrogance</i> shall be your downfall..."
        [/message]
        [terrain]
            terrain=Qxu^Scfz
            x=50,49-51
            y=35,36
        [/terrain]
        [unit]
            side=6
            type=Mechanical Dragon
            id=Mech_D
            x,y=50,35
            facing=nw
        [/unit]
        [redraw][/redraw]
        [message]
            speaker=Mech_D
            message=_"*BWAAAMPH!*" # try to come up with something less stupid
        [/message]
        [message]
            speaker=narrator
            image=wesnoth-icon.png
            message=_"The mechanical monster made a strange, ear-splitting noise that was like nothing the humans or khthon had ever heard before..."
        [/message]
    [/event]

    [event]
        name=exit_hex
        [filter]
            side=1,3,5
            x,y=62,4
        [/filter]
        [filter_condition]
            [variable]
                name=tri_on_surface
                equals=no
            [/variable]
        [/filter_condition]
        [allow_undo][/allow_undo]

        [unit]
            side=4
            type=Tri_Mech_Scout
            x,y=53,12
        [/unit]
        [unit]
            side=4
            type=Tri_Mech_Scout
            x,y=51,22
        [/unit]
        [unit]
            side=4
            type=Tri_Mech_Scout
            x,y=35,54
        [/unit]
        [unit]
            side=4
            type=Tri_Mech_Drone
            x,y=49,22
        [/unit]
        [unit]
            side=4
            type=Tri_Mech_Scout
            x,y=27,43
        [/unit]
    [/event]

    [event]
        name=attack_end
        {BRANCH_PRIMEVAL}
        [filter]
            side=3
        [/filter]
        [filter_second]
            id=Mech_D
        [/filter_second]
        [message]
            speaker=Dardrus
            message=_"Well, that didn't seem very effective.  Let's avoid that thing for now..."
        [/message]
    [/event]

    [event]
        name=last_breath
        {BRANCH_PRIMEVAL}
        [filter]
            id=Keldan
        [/filter]
        [message]
            speaker=unit
            message=_"So this is the end...  I'll never know... if..."
        [/message]
        [message]
            speaker=Haldrad
            message=_"He was a good man back when he was an elf, but the elves have suffered a very strange illness.  I hope that in death, they find peace and freedom from the green-eyed daemons."
        [/message]
        [message]
            speaker=Echidna
            message=_"We are not <i>daemons!</i>  But you are sad little animals, and your silly little kingdoms fold when confronted, just like my dear Seth's little circus show is collapsing now!"
        [/message]
    [/event]

    # 20131110 - still to do, Echidna drops the Sceptre.  Also, need to follow up on here activities as she goes into hiding.
    [event]
        name=last_breath
        {BRANCH_PRIMEVAL}
        [filter]
            id=Echidna
        [/filter]
        [message]
            speaker=unit
            message=_"This is not the end of me..."
        [/message]
        [message]
            speaker=Haldrad
            message=_"Sure looks like the end to me!"
        [/message]
        [message]
            speaker=Dardrus
            message=_"I wouldn't be so sure, Prince Haldrad.  Keep your guard up!"
        [/message]
        [set_variable]
            name=gateB_open
            value=yes
        [/set_variable]
        [set_variable]
            name=gateE_open
            value=yes
        [/set_variable]
        [kill]
            id=Echidna
            animate=yes
        [/kill]
        [item]
            image=items/sceptre-of-fire.png
            x,y=$unit.x|,$unit.y|
        [/item]
        # there is probably a more elegant way to deal with this, but let's worry about that later
        [set_variable]
            name=sceptre_x
            value=$unit.x
        [/set_variable]
        [set_variable]
            name=sceptre_y
            value=$unit.y
        [/set_variable]
        [event]
            name=moveto
            [filter]
                side=1,3
                x,y=$sceptre_x|,$sceptre_y|
            [/filter]
            [if]
                [variable]
                    name=unit.side
                    equals=3
                [/variable]
                [then]
                    [message]
                        speaker=unit
                        message=_"This mighty wand can shoot explosive fire, I've seen it with my own eyes!  We'll fry the enemy now!"
                    [/message]
                    [message]
                        speaker=Haldrad
                        message=_"We could do that, but that thing also attracts all sorts of attention, and if we lose it, we can't go home.  We need to keep it hidden."
                    [/message]
                    [message]
                        speaker=unit
                        message=_"Right, I see.  I'll pass it along as soon as I can."
                    [/message]
                [/then]
                [else]
                    [message]
                        speaker=Haldrad
                        message=_"We need the Sceptre to power the flying mountain to get home.  It's a powerful weapon, but we'll need to keep it under wraps for now."
                    [/message]
                [/else]
            [/if]
            [message]
                speaker=Haldrad
                message=_"Now we have to focus our efforts on defeating the lord of this strange world, lest it come back to attack us again."
            [/message]
            [remove_item]
                x,y=$sceptre_x|,sceptre_y|
                image=items/sceptre-of-fire.png
            [/remove_item]
        [/event]
        [objectives]
            side=1
            [objective]
                condition=win
                description=_ "Find and Defeat Seth"
            [/objective]
            [objective]
                condition=lose
                description=_ "Death of Haldrad"
            [/objective]
            [objective]
                condition=lose
                description=_ "Death of Ponce"
            [/objective]
            [objective]
                condition=lose
                description=_ "Death of Lyron"
            [/objective]
        [/objectives]
        [objectives]
            side=3
            [objective]
                condition=win
                description=_ "Find and Defeat Seth"
            [/objective]
            [objective]
                condition=lose
                description=_ "Death of Dardrus"
            [/objective]
            [objective]
                condition=lose
                description=_ "Death of Bresda"
            [/objective]
        [/objectives]
    [/event]

    # 20131110 - still need to make the units for this to actually work.  Also, test whether creating a unit on an occupied hex has some find_vacant thing...
    # CURRANT PLAN is that Beast3 retreats back to surface, Beast4 & 5 also retreat, but are decoys.  Beasts1 & 2 are big and strong.
    # On surface, Beast3 goes to Mech_D and gets into faked fight.  Seth is now the Mechanical Dragon.
    # Once all beasts are killed, the heroes think to leave the Dark Planet, but Nemesis comes out, and is very mean - won't let them back aboard the mountain, says they need to find Echidna and Seth.
    [event]
        name=last_breath
        {BRANCH_PRIMEVAL}
        [filter]
            id=Seth
        [/filter]
        [message]
            speaker=unit
            message=_"You are quite strong, but it will take more than just a strong arm to defeat me...  "
        [/message]
        [kill]
            id=Seth
        [/kill]
        [unit]
            type=Seth Beast
            side=2
            id=Beast1
            x,y=$unit.x|,$unit.y|
        [/unit]
        [unit]
            type=Seth Beast2
            side=2
            id=Beast2
            x,y=$unit.x|,$unit.y|
        [/unit]
        # this one is the gleam-in-the-eye beast that player needs to pursue
        [unit]
            type=Seth Beast3
            id=Beast3
            side=2
            x,y=$unit.x|,$unit.y|
        [/unit]
        [unit]
            type=Seth Beast4
            side=2
            x,y=$unit.x|,$unit.y|
        [/unit]
        [unit]
            type=Seth Beast4
            side=2
            x,y=$unit.x|,$unit.y|
        [/unit]
        [event]
            name=moveto
            [filter]
                id=Beast3
                x,y=16,11
            [/filter]
            {BRANCH_PRIMEVAL}
            # find Mech_D stored unit, change location to 29,15
            {TRI_DARK_PLANET_UPPER (id=$unit.id) ($unit.side)}
            {MOVE_UNIT (id=$unit.id) 29 13}
            {MOVE_UNIT (id=Mech_D) 29 14}
            [animate_unit]
                flag=attack
                [filter]
                    id=Beast3
                [/filter]
                hits=yes
                [primary_attack]
                    name=jaw
                [/primary_attack]
                [facing]
                    [filter_adjacent_location]
                        adjacent=s
                    [/filter_adjacent_location]
                [/facing]
            [/animate_unit]
            [animate_unit]
                flag=attack
                [filter]
                    id=Mech_D
                [/filter]
                hits=yes
                [primary_attack]
                    name=guns
                [/primary_attack]
                [facing]
                    [filter_adjacent_location]
                        adjacent=n
                    [/filter_adjacent_location]
                [/facing]
            [/animate_unit]
            # Seth takes over Mech_D, it becomes dormant
            {FLASH_RED (
                {QUAKE "rumble.ogg"}
                [kill]
                    id=Beast3,Mech_D
                [/kill]
                [item]
                    halo=misc/mech_d.png
                    x,y=29,14
                [/item]
                [terrain]
                    terrain=Urb^Xo
                    x,y=29,14
                [/terrain]
                [redraw][/redraw]
                [set_variable]
                    name=seth_dragon
                    value=asleep
                [/set_variable]
            )}
            {TRI_DARK_PLANET_LOWER (id=dummy) (2)} # will this cause problems?
            [event]
                name=side 3 turn
                [filter_condition]
                    [variable]
                        name=tri_on_surface
                        equals=yes
                    [/variable]
                    [variable]
                        name=seth_dragon
                        equals=asleep
                    [/variable]
                [/filter_condition]
                [message]
                    side=3
                    message=_"The enemy leaders have been defeated!  We've won, now let's go home!"
                [/message]
                [unit]
                    side=3
                    x,y=68,62
                    type=Primeval Nemesis2
                    id=Nemesis
                    name=Nemesis
                    facing=nw
                [/unit]
                [message]
                    speaker=Nemesis
                    message=_"Not so fast!  You have not defeated the enemy, they lurk amongst us..."
                [/message]
                [set_variable]
                    name=hidden_echidna
                    value=yes
                [/set_variable]
		[unit]
		side=8
		type=Lunar Crab
		x,y=1,3
		role=echidna
		[/unit]
		[unit]
		side=8
		type=Lunar Bug
		x,y=11,5
		[/unit]
		[unit]
		side=8
		type=Lunar Bug
		x,y=50,68
		[/unit]
		[unit]
		side=8
		type=Lunar Mantis
		x,y=55,1
		[/unit]
		[unit]
		side=8
		type=Lunar Worm
		x,y=68,27
		[/unit]
                # update objectives
#ifdef __UNUSED__
                [event]
                    name=moveto
                    first_time_only=no
                    [filter]
                        side=1,3
                        race=human,south-seas_human
                        [not]
                            [filter_location]
                                terrain=*^Uyod
                            [/filter_location]
                        [/not]
                        [not]
                            id=Bresda,Haldrad,Ponce
                        [/not]
                    [/filter]
                    [filter_condition]
                        [variable]
                            name=tri_on_surface
                            equals=yes
                        [/variable]
                        [variable]
                            name=hidden_echidna
                            equals=yes
                        [/variable]
                    [/filter_condition]
                    [set_variable]
                        name=c_t_e
                        rand=1..10
                    [/set_variable]
                    [if]
                        [variable]
                            name=c_t_e
                            equals=1
                        [/variable]
                        [then]
                            [store_unit]
                                [filter]
                                    id=$unit.id
                                [/filter]
                                variable=new_echidna
                                kill=no
                            [/store_unit]
                            {CLEAR_VARIABLE hidden_echidna}
                            {CLEAR_VARIABLE c_t_e}
                            [set_variable]
                                name=new_echidna.name
                                value=Echidna
                            [/set_variable]
                            [set_variable]
                                name=new_echidna.side
                                value=5
                            [/set_variable]
                            [set_variable]
                                name=new_echidna.max_hitpoints
                                value=130
                            [/set_variable]
                            [set_variable]
                                name=new_echidna.hitpoints
                                value=130
                            [/set_variable]
                            [set_variable]
                                name=new_echidna.alignment
                                value=chaotic
                            [/set_variable]
                            [set_variable]
                                name=new_echidna.canrecruit
                                value=yes
                            [/set_variable]
                            [unstore_unit]
                                variable=new_echidna
                                find_vacant=no
                            [/unstore_unit]
                            [message]
                                id=$new_echidna.id
                                message=_"We are still here ..."
                            [/message]
                            [set_variable]
                                name=seth_dragon
                                value=awake
                            [/set_variable]
                        [/then]
                    [/if]
                [/event]
#endif
                # After Nemesis shows up, Mech_D/Seth becomes active again, and is damaged and radioactive
                [event]
                    name=new turn
                    [filter_condition]
                        [have_unit]
                            id=Mech_Seth
                        [/have_unit]
                    [/filter_condition]
                    [message]
                        speaker=Mech_Seth
                        message=_"I HAVE TRAVELLED FAR AND SEEN MUCH.  I WILL NOT FALL TO THE LIKES OF YOU.  I WILL BE WHOLE AGAIN.  I WILL HAVE YOUR WORLD."
                    [/message]
                [/event]
                [event]
                    name=new turn
                    [filter_condition]
                        [variable]
                            name=seth_dragon
                            equals=awake
                        [/variable]
                        [variable]
                            name=tri_on_surface
                            equals=yes
                        [/variable]
                    [/filter_condition]
                    {CLEAR_VARIABLE seth_dragon}
                    [terrain]
                        terrain=Urb
                        x,y=29,14
                    [/terrain]
                    [remove_item]
                        x,y=29,14
                    [/remove_item]
                    [unit]
                        side=7
                        type=Mech_Seth Dragon
                        id=Mech_Seth
                        x,y=29,14
                        name=Seth
                    [/unit]
                    [message]
                        speaker=Mech_Seth
                        message=_"YOU WILL NOT ESCAPE."
                    [/message]
                    [objectives]
                        side=1
                        [objective]
                            condition=win
                            description=_ "Defeat Seth"
                        [/objective]
                        [objective]
                            condition=lose
                            description=_ "Death of Haldrad"
                        [/objective]
                        [objective]
                            condition=lose
                            description=_ "Seth reaches the ice mountain"
                        [/objective]
                        #            note= _"There are two levels to this map, similar to the tower scenario.  Use the right-click menu to manually switch between levels."
                    [/objectives]
                    [objectives]
                        side=3
                        [objective]
                            condition=win
                            description=_ "Defeat Seth"
                        [/objective]
                        [objective]
                            condition=lose
                            description=_ "Death of Dardrus"
                        [/objective]
                        [objective]
                            condition=lose
                            description=_ "Death of Bresda"
                        [/objective]
                    [/objectives]
                [/event]
		[event]
		name=new turn
		first_time_only=no
                    [filter_condition]
                        [variable]
                            name=tri_on_surface
                            equals=yes
                        [/variable]
                        [variable]
                            name=hidden_echidna
                            equals=yes
                        [/variable]
			[have_unit]
			    side=8
			    count=0-3
			[/have_unit]
                    [/filter_condition]
		[unit]
		side=8
		type=Lunar Bug
		x,y=1,46
		[/unit]
		[unit]
		side=8
		type=Lunar Crab
		x,y=11,1
		[/unit]
		[unit]
		side=8
		type=Lunar Worm
		x,y=65,1
		[/unit]
		[/event]
# Echidna causes trouble on the perifery
		[event]
		name=die
		first_time_only=no
		[filter]
		side=8
		role=echidna
		[/filter]
		[if]
		    [have_unit]
			id=Haldrad,Dardrus,Tanyche,Ponce,Lyron,Bresda
			x,y=$x2,$y2
		    [/have_unit]
			[then]
			[message]
			speaker=narrator
			message=_"$second_unit.name| noticed a very faint green glow, like some sort of mist, rise from the dead animal.  It dissipated quickly."
			[/message]
			[unit]
			side=8
			type=Lunar Bug
			x,y=1,38
			[/unit]
			[role]
			role=echidna
			type=Lunar Crab,Lunar Mantis,Lunar Worm,Lunar Bug
			[and]
			    [not]
				role=echidna
			    [/not]
			[/and]
			[/role]
			[/then]
			[else]
			[message]
			speaker=narrator
			message=_"$second_unit.name| noticed a very faint green glow, like some sort of mist, rise from the dead animal.  It surrounded $second_unit.name|, then dissipated, as did $second_unit.name|'s thoughts."
			[/message]
			{MODIFY_UNIT (id=$second_unit.id) side 8}		   
			{MODIFY_UNIT (id=$second_unit.id) alignment chaotic}
			{MODIFY_UNIT (id=$second_unit.id) race monster}
			{MODIFY_UNIT (id=$second_unit.id) role echidna}
			[/else]
		[/if]
		[/event]
                [event]
                    name=last_breath
                    [filter]
                        id=Mech_Seth
                    [/filter]
                    [message]
                        speaker=Mech_Seth
                        message=_"YOU WILL NOT TRIUMPH OVER ME."
                    [/message]
                    [kill]
                        id=Mech_Seth
                    [/kill]
                    [unit]
                        side=2
                        id=Mech_Seth2
                        type=Mech_Seth Dragon2
                        name=Seth
                        x,y=$x1,$y1
                    [/unit]
                    [message]
                        speaker=Nemesis
                        message=_"Your bluster does not impress me, I shall deliver you to oblivion, as you deserve."
                    [/message]
                    [event]
                        name=attacker_hits
                        [filter]
                            id=Nemesis
                        [/filter]
                        [filter_second]
                            id=Mech_Seth2
                        [/filter_second]
                        [store_locations]
                            variable=new_spot
                            [and]
                                [filter]
                                    id=Mech_Seth2
                                [/filter]
                                radius=1
                            [/and]
                            [and]
                                [not]
                                    [filter]
                                        id=Mech_Seth2
                                    [/filter]
                                [/not]
                            [/and]
                            [and]
                                [not]
                                    [filter]
                                        id=Nemesis
                                    [/filter]
                                    radius=1
                                [/not]
                            [/and]
                        [/store_locations]
                        [teleport]
                            [filter]
                                id=Mech_Seth2
                            [/filter]
                            x,y=$new_spot[1].x|,$new_spot[1].y|
                            animate=no
                            check_passability=no
                        [/teleport]
                        [if]
                            [have_location]
                                [filter]
                                    id=Mech_Seth2
                                [/filter]
                                terrain=Qxu,Qxu^Scoz
                            [/have_location]
                            [then]
                                [message]
                                    speaker=Mech_Seth2
                                    message=_"NO."
                                [/message]
                                [kill]
                                    id=Mech_Seth2
                                [/kill]
                                {FLASH_RED ({QUAKE "rumble.ogg"})}
                                [color_adjust]
                                    red,green,blue=25,-5,-5
                                [/color_adjust]
                                [message]
                                    side=3
                                    message=_"We need to get out of here!"
                                [/message]
                                [message]
                                    speaker=Nemesis
                                    message=_"Get back into the mountain, we will return to the land more familiar to you..."
                                [/message]
                                {MOVE_UNIT (id=Ponce) 67 62}
                                {MOVE_UNIT (id=Haldrad) 67 62}
                                {MOVE_UNIT (id=Dardrus) 67 62}
                                {MOVE_UNIT (id=Bresda) 67 62}
                                [endlevel]
                                    {CONTINUE}
                                [/endlevel]
                            [/then]
                        [/if]
                    [/event]
                [/event]
            [/event]
        [/event]
    [/event]
    ########################
    # Test
    ######################
#ifdef __UNUSED__
    [event]
        name=attacker_hits
        first_time_only=no
        [filter]
            side=1
        [/filter]
        [filter_second]
            type=Khalkotaurus
        [/filter_second]
        [store_locations]
            variable=new_spot
            #				[filter_location]
            [and]
                [filter]
                    type=Khalkotaurus
                [/filter]
                radius=1
            [/and]
            [and]
                [not]
                    [filter]
                        type=Khalkotaurus
                    [/filter]
                [/not]
            [/and]
            [and]
                [not]
                    [filter]
                        id=$unit.id
                    [/filter]
                    radius=1
                [/not]
            [/and]
            #				[/filter_location]
        [/store_locations]
        [teleport]
            [filter]
                id=$second_unit.id
            [/filter]
            x,y=$new_spot[1].x|,$new_spot[1].y|
            animate=no
            check_passability=no
        [/teleport]
        [if]
            [have_location]
                [filter]
                    id=$second_unit.id
                [/filter]
                terrain=Qxu,Qxu^Scoz
            [/have_location]
            [then]
                [message]
                    speaker=$second_unit.id
                    message=_"NO."
                [/message]
                [kill]
                    id=$second_unit.id
                [/kill]
            [/then]
        [/if]
    [/event]
#endif
    #####################################
    [event]
        name=moveto
        [filter]
            id=Mech_Seth
            x,y=60-68,57-63
        [/filter]
        [message]
            speaker=unit
            message=_"THIS MOUNTAIN IS GOING NOWHERE.  YOU WILL PERISH HERE."
        [/message]
        [message]
            speaker=Haldrad
            message=_"Unfortunately, that is true...  He is destroying our mountain..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    ##################################
    # death catch-alls
    ##################################
    [event]
        name=last breath
        [filter]
            canrecruit=yes
            [filter_side]
                controller=human
            [/filter_side]
        [/filter]
        [message]
            speaker=unit
            message=_"Oh, what a world..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
    [event]
        name=last breath
        [filter]
            id=E_Caldera,Ponce,Lyron
        [/filter]
        [message]
            speaker=unit
            message=_"Oh, what a world..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
    #####################################
    [event]
        name=exit_hex
        [filter]
            side=1,3,5
            x,y=21-30,29-31
        [/filter]
        [filter_condition]
            [variable]
                name=tri_on_surface
                equals=no
            [/variable]
        [/filter_condition]
        [unstore_unit]
            variable=seth
        [/unstore_unit]
        {CLEAR_VARIABLE seth}
        [message]
            speaker=Seth_
            message=_"Hello..."
        [/message]
        [message]
            speaker=unit
            message=_"You!  You are the one responsible for this!"
        [/message]
        [event]
            name=new turn
            [message]
                side=3
                message=_"Why have you done this, who <i>are</i> you?"
            [/message]
            [message]
                speaker=Seth_
                message=_"I have been stuck in your little backwater world for much longer than I intended, but now I am getting my plans back on track."
            [/message]
            [message]
                side=1
                message=_"What is that supposed to mean?"
            [/message]
            [message]
                side=3
                message=_"He is deranged..."
            [/message]
        [/event]
        # I need to store/unstore locations here, to restore overlay layers, but I'll worry about that later
        [event]
            name=side 2 turn
            first_time_only=no
            [filter_condition]
                [variable]
                    name=tri_on_surface
                    equals=no
                [/variable]
                [variable]
                    name=branch
                    equals=primeval
                [/variable]
                [have_unit]
                    id=Seth
                [/have_unit]
            [/filter_condition]
            #	    {BRANCH_PRIMEVAL}
            [store_unit]
                [filter]
                    id=Seth
                [/filter]
                variable=seth
                kill=no
            [/store_unit]
            [terrain]
                x,y=$seth.x|,$seth.y|
                radius=1
                layer=overlay
                terrain=Gg^Cov
            [/terrain]
            [terrain]
                x,y=$seth.x|,$seth.y|
                layer=overlay
                terrain=Gg^Kov
            [/terrain]
        [/event]
        [event]
            name=side 2 turn end
            first_time_only=no
            [filter_condition]
                [variable]
                    name=tri_on_surface
                    equals=no
                [/variable]
                [variable]
                    name=branch
                    equals=primeval
                [/variable]
                [have_location]
                    terrain=*^Kov
                    x,y=$seth.x|,$seth.y|
                [/have_location]
            [/filter_condition]
            [terrain]
                x,y=$seth.x|,$seth.y|
                radius=1
                layer=overlay
                terrain=Gg^Es
            [/terrain]
            {CLEAR_VARIABLE seth}
        [/event]
    [/event]

    [event]
        name=exit_hex
        [filter]
            side=1,3,5
            x,y=28,2
        [/filter]
        [filter_condition]
            [variable]
                name=tri_on_surface
                equals=no
            [/variable]
        [/filter_condition]
        [unit]
            side=2
            type=Seth
            id=Seth_
            name=Seth
            facing=nw
            x,y=32,5
        [/unit]
        [message]
            speaker=Seth_
            message=_"Hello..."
        [/message]
        [message]
            speaker=unit
            message=_"You, I should-"
        [/message]
        [message]
            speaker=Seth_
            message=_"Are you going to <i>threaten</i> me?  I am not here to fight you, I was just going to say that a wise man once said:
        <i>If you see a fork in the road, take it!</i>

        Hahaha..."
        [/message]
        [kill]
            id=Seth_
        [/kill]
        [message]
            speaker=unit
            message=_"Grrr.  He taunts us, but we will get him!"
        [/message]
        [event]
            name=moveto
            [filter_condition]
                [variable]
                    name=tri_on_surface
                    equals=no
                [/variable]
            [/filter_condition]
            [filter]
                side=1,3,5
                x,y=32-33,5
            [/filter]
            [terrain]
                terrain=Urfz
                x,y=34,5
            [/terrain]
            [redraw]
                side=1,3,5
            [/redraw]
            [message]
                speaker=unit
                message=_"I didn't touch anything, the stone door just moved aside!"
            [/message]
            [set_variable]
                name=gateA1_open
                value=yes
            [/set_variable]
        [/event]
        [event]
            name=moveto
            [filter_condition]
                [variable]
                    name=tri_on_surface
                    equals=no
                [/variable]
            [/filter_condition]
            [filter]
                side=1,3,5
                x,y=30-31,6
            [/filter]
            [terrain]
                terrain=Urfz
                x,y=31,7
            [/terrain]
            [unit]
                type=Tomb Protector
                id=Protector1
                side=2
                x,y=24,7
            [/unit]
            [unit]
                type=Tomb Sentinel
                side=2
                x,y=26,7
            [/unit]
            [unit]
                type=Tomb HighArcher
                side=2
                x,y=25,9
            [/unit]
            [redraw]
                side=1,3,5
            [/redraw]
            [message]
                speaker=unit
                message=_"I didn't touch anything, the stone door just moved aside!"
            [/message]
            [set_variable]
                name=gateA2_open
                value=yes
            [/set_variable]
            [event]
                name=die
                [filter]
                    id=Protector1
                [/filter]
                [set_variable]
                    name=gateA1_open
                    value=yes
                [/set_variable]
                [message]
                    speaker=second_unit
                    message=_"Well, it seems this path was a dead end..."
                [/message]
                {SETH_MESSAGE ("Oh, cheer up!  I was just toying with you!")}
                [terrain]
                    terrain=Urfz
                    x,y=34,5
                [/terrain]
                [unit]
                    side=2
                    type=$second_unit.type
                    x,y=42,10
                    id=Double1
                    [modifications]
                        [object]
                            silent=yes
                            duration=forever
                            [filter]
                                id=Double1 # is this needed?
                            [/filter]
                            [effect]
                                apply_to=attack
                                range=melee
                                increase_damage=20%
                            [/effect]
                            [effect]
                                apply_to=attack
                                range=ranged
                                increase_damage=20%
                            [/effect]
                            [effect]
                                apply_to=hitpoints
                                increase_total=50%
                                heal_full=yes
                            [/effect]
                            [effect]
                                apply_to=resistance
                                replace=no
                                [resistance]
                                    arcane=30
                                    fire=10
                                    cold=-15
                                    blade=-10
                                    pierce=-10
                                    impact=-10
                                [/resistance]
                            [/effect]
                            [effect]
                                apply_to=image_mod
                                replace="O(0.4)"
                            [/effect]
                        [/object]
                    [/modifications]
                [/unit]
                {MODIFY_UNIT (id=Double1) alignment chaotic}
            [/event]
        [/event]
    [/event]

    # these two events are tied together
    [event]
        name=moveto
        [filter]
            side=1,3,5
            x,y=44,17
        [/filter]
        [filter_condition]
            [variable]
                name=tri_on_surface
                equals=yes
            [/variable]
            [not]
                [variable]
                    name=gate3_open
                    equals=yes
                [/variable]
            [/not]
        [/filter_condition]
        [set_variable]
            name=gate3_open
            value=yes
        [/set_variable]
        [unit]
            type=Tri_Mech_Cyborg
            side=4
            x,y=51,19
        [/unit]
        [unit]
            type=Tri_Mech_Cyborg
            side=4
            x,y=51,21
        [/unit]
        [unit]
            type=Tri_Mech_Defender
            id=Defender1
            side=4
            x,y=52,20
        [/unit]
        [unit]
            type=Tri_Mech_Drone
            side=4
            x,y=52,19
        [/unit]
        [terrain]
            terrain=Fyp
            x,y=45,18
        [/terrain]
        [redraw]
            side=1,3,5
        [/redraw]
        [event]
            name=die
            [filter]
                id=Defender1
            [/filter]
            [set_variable]
                name=gate4_open
                value=yes
            [/set_variable]
            [terrain]
                terrain=Fyp
                x,y=54,15
            [/terrain]
            [redraw]
                side=1,3,5
            [/redraw]
        [/event]
    [/event]
    [event]
        name=moveto
        [filter]
            side=1,3,5
            x,y=55,15
        [/filter]
        [filter_condition]
            [variable]
                name=tri_on_surface
                equals=yes
            [/variable]
            [not]
                [variable]
                    name=gate4_open
                    equals=yes
                [/variable]
            [/not]
        [/filter_condition]
        [set_variable]
            name=gate4_open
            value=yes
        [/set_variable]
        [unit]
            type=Tri_Mech_Cyborg
            side=4
            x,y=51,19
        [/unit]
        [unit]
            type=Tri_Mech_Cyborg
            side=4
            x,y=51,21
        [/unit]
        [unit]
            type=Tri_Mech_Defender
            id=Defender2
            side=4
            x,y=52,20
        [/unit]
        [unit]
            type=Tri_Mech_Drone
            side=4
            x,y=52,19
        [/unit]
        [terrain]
            terrain=Fyp
            x,y=54,15
        [/terrain]
        [redraw]
            side=1,3,5
        [/redraw]
        [event]
            name=die
            [filter]
                id=Defender2
            [/filter]
            [set_variable]
                name=gate3_open
                value=yes
            [/set_variable]
            [terrain]
                terrain=Fyp
                x,y=45,18
            [/terrain]
            [redraw]
                side=1,3,5
            [/redraw]
        [/event]
    [/event]

    [event]
        name=exit_hex
        [filter]
            side=1,3,5
            x,y=62,4
        [/filter]
        [filter_condition]
            [variable]
                name=tri_on_surface
                equals=no
            [/variable]
        [/filter_condition]
        [allow_undo][/allow_undo]
        [unit]
            side=2
            type=Tomb Stalker
            x,y=55,12
        [/unit]
        [unit]
            side=2
            type=Tomb Archer
            x,y=61,10
        [/unit]
        [unit]
            side=2
            type=Tomb Stalker
            x,y=60,11
        [/unit]
        [unit]
            side=4
            type=Tri_Mech_Drone
            x,y=51,13
        [/unit]
        [unit]
            side=4
            type=Tri_Mech_Drone
            x,y=51,16
        [/unit]
        [unit]
            side=4
            type=Tri_Mech_Cyborg
            x,y=50,12
        [/unit]
        [unit]
            side=4
            type=Tri_Mech_Cyborg
            x,y=52,13
        [/unit]
        [unit]
            side=4
            type=Tri_Mech_Cyborg
            x,y=51,21
        [/unit]
        [unit]
            side=4
            type=Tri_Mech_Cyborg
            x,y=53,22
        [/unit]
        [unit]
            side=4
            type=Tri_Mech_Cyborg_Captain
            id=M_Captain1
            name="Cyborg Captain"
            x,y=51,22
        [/unit]
        [event]
            name=last_breath
            [filter]
                id=M_Captain1
            [/filter]
            [message]
                speaker=unit
                message=_"<i>(mummble...)</i>"
            [/message]
            [terrain]
                terrain=Fyp
                x,y=47,21
            [/terrain]
            [set_variable]
                name=gateC_open
                value=yes
            [/set_variable]
        [/event]
    [/event]

    # 20131110 - still need to give the player some cool toy or something.
    [event]
        name=moveto
        [filter]
            x=16,17
            y=52,53
            id=Tanyche
        [/filter]
        {BRANCH_PRIMEVAL}
        [message]
            speaker=unit
            message=_"I remember this gate!  Behind it was an armory, that's why we copied the key..."
        [/message]
        [terrain]
            terrain=Urfz
            x,y=15-16,53
        [/terrain]
        [item]
            image=items/armor.png
            x,y=5,54
        [/item]
        [item]
            image=items/sword.png
            x,y=5,55
        [/item]
        [item]
            image=items/book1.png
            x,y=8,54
        [/item]
        [item]
            image=scenery/trash.png
            x,y=4,54
        [/item]
        [item]
            image=items/axe.png
            x,y=9,56
        [/item]
        [set_variable]
            name=thunder_axe
            value=yes
        [/set_variable]
        [redraw]
            side=1,3
        [/redraw]
        [set_variable]
            name=gateF_open
            value=yes
        [/set_variable]
        [event]
            name=moveto
            [filter]
                side=1,3
                x,y=5,54
            [/filter]
            [filter_condition]
                [variable]
                    name=tri_on_surface
                    equals=no
                [/variable]
            [/filter_condition]
            [message]
                speaker=unit
                message=_"This armor looks badly damaged...  It would slow me down, but provide very little protection."
            [/message]
        [/event]
        [event]
            name=moveto
            [filter]
                side=1,3
                x,y=5,55
            [/filter]
            [filter_condition]
                [variable]
                    name=tri_on_surface
                    equals=no
                [/variable]
            [/filter_condition]
            [message]
                speaker=unit
                message=_"This sword looks unfinished, the blade is just a slab of metal.  This supposed weapons stash is pretty disappointing... "
            [/message]
        [/event]
        [event]
            name=moveto
            first_time_only=no
            [filter]
                side=1,3
                x,y=9,56
            [/filter]
            [filter_condition]
                [variable]
                    name=tri_on_surface
                    equals=no
                [/variable]
                [variable]
                    name=thunder_axe
                    equals=yes
                [/variable]
            [/filter_condition]
            # needs to be a strong unit to wield the axe
            [if]
                [have_unit]
                    x,y=$x1,$y1
                    [and]
                        type=SouthSeas AbleSeaman,SouthSeas DeckMaster,SouthSeas Salvager,SouthSeas Wrecker
                        [or]
                            race=orc,dwarf
                        [/or]
                        [or]
                            id=Dardrus
                        [/or]
                    [/and]
                [/have_unit]
                [then]
                    [message]
                        speaker=unit
                        message=_"This axe is huge, it must have been made for a giant...  But there is a power to this, it could be useful, if unwieldly."
                    [/message]
                    [message]
                        speaker=narrator
                        image=wesnoth-icon.png
                        message=_"$unit.name| picked up the mighty axe and gave it a practice swing.  It was heavy and $unit.name| knew he would not get many chances to strikes if he used it in combat, but there was a deadly power to the thing, so he had a feeling that might not matter."
                    [/message]
                    [remove_item]
                        image=items/axe.png
                        x,y=9,56
                    [/remove_item]
                    {CLEAR_VARIABLE thunder_axe}
                    [object]
                        id=axe
                        [filter]
                            x,y=$x1,$y1
                        [/filter]
                        image=attacks/battleaxe.png
                        name=_"Thunder Axe"
                        description=_"This axe was not made for the puny common man, this is an axe fit for a god!  Or at least one of the gods' fearsome warriors.  It is massive and wouldn't be suitable for combat, but there is a certain charge and glow to it."
                        [effect]
                            apply_to=new_attack
                            name=thunder axe
                            description= _ "thunder axe"
                            icon=attacks/battleaxe.png~CS(0,10,20)
                            type=fire
                            range=melee
                            [specials]
                                {WEAPON_SPECIAL_MAGICAL}
                            [/specials]
                            damage=48
                            number=1
                        [/effect]

                        [effect]
                            apply_to=new_animation

                            [attack_anim]
                                [filter_attack]
                                    name=thunder axe
                                [/filter_attack]
                                start_time=-100
                                swoosh_start_time=-150
                                swoosh_offset=1.0
                                swoosh_layer=92
                                swoosh_alpha=0.0~1.0:150,1.0~0.0:150
                                [swoosh_frame]
                                    duration=300
                                    image=misc/slash-1.png:100,misc/slash-2.png:100,misc/slash-3.png:100
                                [/swoosh_frame]
                                [frame]
                                    duration=200
                                    sound=fire.wav
                                [/frame]
                            [/attack_anim]
                        [/effect]
                    [/object]
                [/then]
                [else]
                    [message]
                        speaker=unit
                        message=_"This axe is <i>gigantic!</i>  What am I supposed to do with it?"
                    [/message]
                [/else]
            [/if]
        [/event]
        [event]
            name=moveto
            [filter]
                x,y=8,54
                side=1,3
                [not]
                    id=Dardrus,Tanyche
                [/not]
            [/filter]
            [filter_condition]
                [variable]
                    name=tri_on_surface
                    equals=no
                [/variable]
            [/filter_condition]
            [message]
                speaker=unit
                message=_"This book looks like it might be a journal, but it's written in an unfamiliar script..."
            [/message]
        [/event]
        [event]
            name=moveto
            [filter]
                x,y=8,54
                id=Dardrus,Tanyche
            [/filter]
            [filter_condition]
                [variable]
                    name=tri_on_surface
                    equals=no
                [/variable]
            [/filter_condition]
            [message]
                speaker=unit
                message=_"This is a journal...  *(thumbs through the pages)*  It was written by a member of an attack force...  Ah, this is interesting:

        <i>Promesus had the Enemy King cornered, and we thought victory was ours, but the old daemon had another trick up his sleeves.  As Promesus' blade struck the King, the daemon shattered into a pack of animals, which turned on us with surprising ferocity.  As we fought them, I couldn't help but notice that one of them had a stange glitter in its eye.  As I write this, I feel that if we had focused out attack on that one, we could have triumphed.
        Instead, we directed our attack on the largest and fiercest of the beasts.  We fell, one by one, and soon there were only a handful of us left.  We fled, and split up in our confusion.  I constantly hear the sounds of the King's servants, it won't be long before they find me.</i>"
            [/message]
            [message]
                speaker=unit
                message=_"Interesting...  Could the Evil King be the skeletal thing with the gold helmet?  This might tell us something about his defenses, let's not make the same mistake!"
            [/message]
        [/event]
    [/event]
    [event]
        name=moveto
        [filter]
            side=1,3
            x=16,17
            y=52,53
            [not]
                id=Tanyche
            [/not]
        [/filter]
        {BRANCH_PRIMEVAL}
        [message]
            speaker=unit
            message=_"This gate is locked, where's that strange woman with the keys?"
        [/message]
    [/event]

    # this was for testing - animation does not seem to work
#ifdef __UNUSED__
    [event]
        name=moveto
        [filter]
            side=1
            x,y=54,54
        [/filter]

        [object]
            id=axe2
            [filter]
                x,y=$x1,$y1
            [/filter]
            image=attacks/battleaxe.png
            name=_"Thunder Axe"
            description=_"This axe was not made for the puny common man, this is an axe fit for a god!  Or at least one of the gods' fearsome warriors.  It is massive and wouldn't be suitable for combat, but there is a certain charge and glow to it."
            [effect]
                apply_to=new_attack
                name=thunder axe
                description= _ "thunder axe"
                icon=attacks/battleaxe.png~CS(0,10,20)
                type=fire
                range=melee
                [specials]
                    {WEAPON_SPECIAL_MAGICAL}
                [/specials]
                damage=48
                number=1
            [/effect]

            [effect]
                apply_to=new_animation

                [attack_anim]
                    [filter_attack]
                        name=thunder axe
                    [/filter_attack]
                    start_time=-100
                    swoosh_start_time=-150
                    swoosh_offset=1.0
                    swoosh_layer=92
                    [swoosh_frame]
                        duration=300
                        image=misc/slash-1.png:100,misc/slash-2.png:100,misc/slash-3.png:100
                    [/swoosh_frame]
                    [frame]
                        duration=200
                        sound=fire.wav
                    [/frame]
                [/attack_anim]
            [/effect]
        [/object]
    [/event]
#endif

    # this needs work
    [event]
        name=victory
        [message]
            speaker=Nemesis
            message=_"If you have that Sceptre, you'd better return it to its cradle in the mountain, Princling."
        [/message]
        [message]
            speaker=Haldrad
            message=_"I do have it, and for now, I will return it."
        [/message]
        [message]
            speaker=Dardrus
            message=_"You'd best hurry!"
        [/message]
        {FLASH_WHITE (
            [store_unit]
                [filter]
                    side=1,3,5
                    [not]
                        id=Nemesis
                    [/not]
                [/filter]
                variable=final_tally
                kill=yes
            [/store_unit]
            [terrain]
                terrain=Dsmz
                x,y=58-68,53-68
            [/terrain]
            [redraw][/redraw]
        )}
        [message]
            speaker=Nemesis
            message=_"I feel ill...  The destroyer may have had his final revenge yet.  ...  But there is still time..."
        [/message]
        {MOVE_UNIT (id=Nemesis) 68 68}
        [kill]
            id=Nemesis
        [/kill]
    [/event]
[/scenario]

[scenario]
    id="Epilogue"
    name= _ "Epilogue"
    map_data="{~add-ons/Trinity/maps/Dark_Planet.map}"
    next_scenario=null
    victory_when_enemies_defeated=no
    turns=-1
    #	{TURNS 8 10 12}

    [music]
        name="New_Wesnoth_Battle_Music.ogg"
    [/music]

    [story]
        [part]
            story= _ "Haldrad had the Sceptre placed back into the machinery where it had been.  Moments later, the winged warrior walked into the marble halls and stood in front of the crystal altar and began the strange ritual that took the mountain away from the dark planet."
            [background_layer]
                image="story/Trinity_space3.jpg"
            [/background_layer]
        [/part]
        [part]
            story= _ "And it was not a moment too soon, for the moon was soon consumed with the flames of Seth's death-throes.  As the mountain drifted back to known land, Nemesis sat down heavily and beckoned Dardrus and Bresda over.  She informed them that though she was a god, Seth had poisoned her with a particularly rare and pernicious miasma, and her time was limited.  While growing increasingly tired, she explained how to land the mountain, then asured them that the gods would watch over them, and neither Seth nor the Khthon would trouble them anymore.  Dardrus had so many questions, but knew Nemesis was not going to be able to answer them in the time she had left.  He also knew that he was watching the delayed twilight of his race, so after he closed Nemesis' vacant eyes, he retired to mull over this."
            [background_layer]
                image="story/Trinity_space4.jpg"
            [/background_layer]
        [/part]
        [part]
            story= _ "After they landed back near the old capital, the travellers surveyed the landscape.  There was a lot of rebuilding to do, much of the land had been turned to desert and cities were detroyed.  But the cause of all the misery had been neutralized, and with any luck, recent events would put the squabbles and differences between the dwarves, orcs, and humans in perspective.  Maybe a lasting peace could be forged from near disaster..."
            [background_layer]
                image="story/Trinity_epilogue.jpg"
            [/background_layer]
        [/part]
    [/story]

    [side]
        side=1
        type=Spearman
        id=Fooby
        canrecruit=yes
        controller=human
        team_name=player
    [/side]

    [event]
        name=prestart
        [endlevel]
            {CONTINUE_NO_SAVE}
        [/endlevel]
    [/event]
[/scenario]
